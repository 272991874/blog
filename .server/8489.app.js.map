{"version":3,"file":"8489.app.js","mappings":";;;;;;;;;;;;AAAO;AACP;AACA;AACA;AACA;AACA,mBAAmB;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;EC9DA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACAiF;AACjF;AACA,CAAmC;AACnC;AACA,iDAAiD,2BAAa;AAC9D;AACA,SAAS,SAAS;AAClB;;;AAGA,wDAAe","sources":["webpack://yaomin/./docs/.vuepress/.temp/pages/devops/build-script.html.js","webpack://yaomin/./docs/.vuepress/.temp/pages/devops/build-script.html.vue","webpack://yaomin/./docs/.vuepress/.temp/pages/devops/build-script.html.vue?e5c5"],"sourcesContent":["export const data = {\n  \"key\": \"v-233aa6f6\",\n  \"path\": \"/devops/build-script.html\",\n  \"title\": \"编译脚本\",\n  \"lang\": \"zh-CN\",\n  \"frontmatter\": {},\n  \"excerpt\": \"\",\n  \"headers\": [\n    {\n      \"level\": 2,\n      \"title\": \"k8s 滚动脚本\",\n      \"slug\": \"k8s-滚动脚本\",\n      \"children\": []\n    },\n    {\n      \"level\": 2,\n      \"title\": \"需要配置哪些\",\n      \"slug\": \"需要配置哪些\",\n      \"children\": [\n        {\n          \"level\": 3,\n          \"title\": \"服务详情\",\n          \"slug\": \"服务详情\",\n          \"children\": []\n        },\n        {\n          \"level\": 3,\n          \"title\": \"部署模板\",\n          \"slug\": \"部署模板\",\n          \"children\": []\n        },\n        {\n          \"level\": 3,\n          \"title\": \"服务器绑定\",\n          \"slug\": \"服务器绑定\",\n          \"children\": []\n        },\n        {\n          \"level\": 3,\n          \"title\": \"日志提取\",\n          \"slug\": \"日志提取\",\n          \"children\": []\n        },\n        {\n          \"level\": 3,\n          \"title\": \"权限管理\",\n          \"slug\": \"权限管理\",\n          \"children\": []\n        }\n      ]\n    }\n  ],\n  \"filePathRelative\": \"devops/build-script.md\",\n  \"git\": {\n    \"contributors\": [\n      {\n        \"name\": \"Amin.Yao\",\n        \"email\": \"Amin.Yao@gaiaworks.cn\",\n        \"commits\": 3\n      }\n    ]\n  }\n}\n","<h1 id=\"编译脚本\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#编译脚本\" aria-hidden=\"true\">#</a> 编译脚本</h1>\n<ul>\n<li>后端</li>\n</ul>\n<div class=\"language-bash ext-sh line-numbers-mode\"><pre v-pre class=\"language-bash\"><code>\n<span class=\"token comment\">#!/bin/bash</span>\n<span class=\"token assign-left variable\">path</span><span class=\"token operator\">=</span><span class=\"token variable\">$1</span>\n<span class=\"token assign-left variable\">dockerfile_name</span><span class=\"token operator\">=</span><span class=\"token variable\">$2</span>\n<span class=\"token assign-left variable\">appname</span><span class=\"token operator\">=</span><span class=\"token variable\">$3</span>\n<span class=\"token assign-left variable\">git_tag</span><span class=\"token operator\">=</span><span class=\"token variable\">$4</span>\n<span class=\"token assign-left variable\">version</span><span class=\"token operator\">=</span><span class=\"token variable\">$5</span>\n<span class=\"token assign-left variable\">packageName</span><span class=\"token operator\">=</span><span class=\"token variable\">$7</span>\n\n<span class=\"token builtin class-name\">source</span> /etc/profile\nmvn -s /data/settings/wfm4.xml clean package <span class=\"token operator\">||</span> <span class=\"token punctuation\">{</span> <span class=\"token builtin class-name\">printf</span> <span class=\"token string\">'[ERROR] build failed, pls check...\\n%.0s'</span> <span class=\"token punctuation\">{</span><span class=\"token number\">1</span><span class=\"token punctuation\">..</span><span class=\"token number\">5</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span> <span class=\"token builtin class-name\">exit</span> <span class=\"token number\">500</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">sudo</span> docker build -f <span class=\"token variable\">$dockerfile_name</span> -t xxxx-e2-01-registry.cn-shanghai.cr.aliyuncs.com/xxxxworks/<span class=\"token variable\">${appname}</span><span class=\"token builtin class-name\">:</span><span class=\"token variable\">$git_tag</span><span class=\"token variable\">${version}</span> <span class=\"token builtin class-name\">.</span>\n<span class=\"token function\">sudo</span> docker push xxxx-e2-01-registry.cn-shanghai.cr.aliyuncs.com/xxxxworks/<span class=\"token variable\">${appname}</span><span class=\"token builtin class-name\">:</span><span class=\"token variable\">$git_tag</span><span class=\"token variable\">${version}</span>\n\n</code></pre><div class=\"line-numbers\"><span class=\"line-number\">1</span><br><span class=\"line-number\">2</span><br><span class=\"line-number\">3</span><br><span class=\"line-number\">4</span><br><span class=\"line-number\">5</span><br><span class=\"line-number\">6</span><br><span class=\"line-number\">7</span><br><span class=\"line-number\">8</span><br><span class=\"line-number\">9</span><br><span class=\"line-number\">10</span><br><span class=\"line-number\">11</span><br><span class=\"line-number\">12</span><br><span class=\"line-number\">13</span><br><span class=\"line-number\">14</span><br><span class=\"line-number\">15</span><br></div></div><ul>\n<li>前端</li>\n</ul>\n<div class=\"language-bash ext-sh line-numbers-mode\"><pre v-pre class=\"language-bash\"><code><span class=\"token shebang important\">#!/bin/bash</span>\n<span class=\"token assign-left variable\">mytime</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">`</span><span class=\"token function\">date</span> +%Y%m%d%H%M%S<span class=\"token variable\">`</span></span>\n<span class=\"token assign-left variable\">path</span><span class=\"token operator\">=</span><span class=\"token variable\">$1</span>\n<span class=\"token assign-left variable\">dockerfile_name</span><span class=\"token operator\">=</span><span class=\"token variable\">$2</span>\n<span class=\"token assign-left variable\">appname</span><span class=\"token operator\">=</span><span class=\"token variable\">$3</span>\n<span class=\"token assign-left variable\">git_tag</span><span class=\"token operator\">=</span><span class=\"token variable\">$4</span>\n<span class=\"token assign-left variable\">version</span><span class=\"token operator\">=</span><span class=\"token variable\">$5</span>\n<span class=\"token comment\">#cd $path</span>\n<span class=\"token builtin class-name\">source</span> /etc/profile\n\n<span class=\"token builtin class-name\">cd</span> public\n<span class=\"token function\">pnpm</span> <span class=\"token function\">install</span>\n<span class=\"token function\">pnpm</span> run build\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token variable\">$?</span> <span class=\"token operator\">!=</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">then</span>\n  <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"[ERROR] public build failed, pls check...\"</span>\n  <span class=\"token builtin class-name\">exit</span> <span class=\"token number\">1</span>\n<span class=\"token keyword\">fi</span>\n\n<span class=\"token function\">sleep</span> 2s\n<span class=\"token comment\">#上传至对象存储</span>\n<span class=\"token builtin class-name\">cd</span> <span class=\"token variable\">$WORKSPACE</span>/public/dest\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token variable\">$?</span> <span class=\"token operator\">!=</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">then</span>\n  <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"[ERROR] public build failed, pls check...\"</span>\n  <span class=\"token builtin class-name\">exit</span> <span class=\"token number\">1</span>\n<span class=\"token keyword\">fi</span>\n<span class=\"token function\">tar</span> czvf <span class=\"token variable\">$version</span>.tgz ./*\n/home/JumpLin/workspace/obsutil/obsutil <span class=\"token function\">cp</span> <span class=\"token variable\">$version</span>.tgz obs://devops-auto/package/<span class=\"token variable\">$active</span>/frontend/Develop/<span class=\"token variable\">$product</span>/\n<span class=\"token function\">rm</span> -rf <span class=\"token variable\">$version</span>.tgz\n\n<span class=\"token builtin class-name\">cd</span>  <span class=\"token variable\">$WORKSPACE</span>/server-maya\n<span class=\"token function\">sudo</span> docker build -t xxxx-e2-01-registry.cn-shanghai.cr.aliyuncs.com/xxxxworks/<span class=\"token variable\">${appname}</span><span class=\"token builtin class-name\">:</span><span class=\"token variable\">$git_tag</span><span class=\"token variable\">${version}</span> <span class=\"token builtin class-name\">.</span>\n<span class=\"token function\">sudo</span> docker push xxxx-e2-01-registry.cn-shanghai.cr.aliyuncs.com/xxxxworks/<span class=\"token variable\">${appname}</span><span class=\"token builtin class-name\">:</span><span class=\"token variable\">$git_tag</span><span class=\"token variable\">${version}</span>\n</code></pre><div class=\"line-numbers\"><span class=\"line-number\">1</span><br><span class=\"line-number\">2</span><br><span class=\"line-number\">3</span><br><span class=\"line-number\">4</span><br><span class=\"line-number\">5</span><br><span class=\"line-number\">6</span><br><span class=\"line-number\">7</span><br><span class=\"line-number\">8</span><br><span class=\"line-number\">9</span><br><span class=\"line-number\">10</span><br><span class=\"line-number\">11</span><br><span class=\"line-number\">12</span><br><span class=\"line-number\">13</span><br><span class=\"line-number\">14</span><br><span class=\"line-number\">15</span><br><span class=\"line-number\">16</span><br><span class=\"line-number\">17</span><br><span class=\"line-number\">18</span><br><span class=\"line-number\">19</span><br><span class=\"line-number\">20</span><br><span class=\"line-number\">21</span><br><span class=\"line-number\">22</span><br><span class=\"line-number\">23</span><br><span class=\"line-number\">24</span><br><span class=\"line-number\">25</span><br><span class=\"line-number\">26</span><br><span class=\"line-number\">27</span><br><span class=\"line-number\">28</span><br><span class=\"line-number\">29</span><br><span class=\"line-number\">30</span><br><span class=\"line-number\">31</span><br><span class=\"line-number\">32</span><br></div></div><ul>\n<li>git_tag($branch): 分支名</li>\n<li>appname: 镜像名</li>\n<li>run_env: 运行环境</li>\n<li>version: 版本号</li>\n<li>product: 项目code</li>\n<li>docker_image: 页面上展示的镜像名</li>\n<li>i($1): ecs部署的IP</li>\n<li>server_location: ecs部署是项目所在目录</li>\n<li>packageName: ecs部署的包名</li>\n</ul>\n<h2 id=\"k8s-滚动脚本\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#k8s-滚动脚本\" aria-hidden=\"true\">#</a> k8s 滚动脚本</h2>\n<ul>\n<li>后端</li>\n</ul>\n<div class=\"language-bash ext-sh line-numbers-mode\"><pre v-pre class=\"language-bash\"><code>\n<span class=\"token comment\">#!/bin/bash</span>\n\nkubectl --kubeconfig ~/.kube/ali-<span class=\"token variable\">${run_env}</span> -n devopsplatform <span class=\"token builtin class-name\">set</span> image deployments.apps/database-transfer database-transfer<span class=\"token operator\">=</span>xxxx-e2-01-registry.cn-shanghai.cr.aliyuncs.com/xxxxworks/database-transfer:<span class=\"token variable\">$docker_image</span> --record\n\n</code></pre><div class=\"line-numbers\"><span class=\"line-number\">1</span><br><span class=\"line-number\">2</span><br><span class=\"line-number\">3</span><br><span class=\"line-number\">4</span><br><span class=\"line-number\">5</span><br></div></div><ul>\n<li>前端</li>\n</ul>\n<div class=\"language-bash ext-sh line-numbers-mode\"><pre v-pre class=\"language-bash\"><code>kubectl --kubeconfig /home/devops/.kube/devops-xxxx -n devops-platform-d <span class=\"token builtin class-name\">set</span> image deployment/devops-frontend devops-frontend<span class=\"token operator\">=</span>xxxx-e2-01-registry.cn-shanghai.cr.aliyuncs.com/xxxxworks/devops-frontend:<span class=\"token variable\">$docker_image</span> --record\n\nkubectl --kubeconfig /home/devops/.kube/devops-xxxx -n devops-platform-d <span class=\"token builtin class-name\">set</span> <span class=\"token function\">env</span> deployment/devops-frontend <span class=\"token assign-left variable\">CDN</span><span class=\"token operator\">=</span>https://xxxx-static-d.obs.cn-east-3.myhuaweicloud.com/devops-frontend/<span class=\"token variable\">$version</span>\n\t\n/home/devops/workspace/obsutil/obsutil <span class=\"token function\">cp</span> obs://devops-auto/package/prod/frontend/Develop/<span class=\"token variable\">$product</span>/<span class=\"token variable\">$version</span>.tgz /home/devops/upload/frontend-obs/<span class=\"token variable\">$product</span>/\n<span class=\"token builtin class-name\">cd</span> /home/devops/upload/frontend-obs/<span class=\"token variable\">$product</span> \n<span class=\"token function\">tar</span> -zxvf <span class=\"token variable\">$version</span>.tgz \n<span class=\"token function\">rm</span> -rf <span class=\"token variable\">$version</span>.tgz\n<span class=\"token function\">sudo</span> <span class=\"token function\">su</span> devops<span class=\"token operator\">&lt;&lt;</span><span class=\"token string\">HERE\n/home/devops/workspace/obsutil/obsutil cp -r -f -flat ./ obs://xxxx-static-d/devops-frontend/<span class=\"token variable\">$version</span>/ \nHERE</span>\n<span class=\"token function\">rm</span> -rf ./*\n\n\n</code></pre><div class=\"line-numbers\"><span class=\"line-number\">1</span><br><span class=\"line-number\">2</span><br><span class=\"line-number\">3</span><br><span class=\"line-number\">4</span><br><span class=\"line-number\">5</span><br><span class=\"line-number\">6</span><br><span class=\"line-number\">7</span><br><span class=\"line-number\">8</span><br><span class=\"line-number\">9</span><br><span class=\"line-number\">10</span><br><span class=\"line-number\">11</span><br><span class=\"line-number\">12</span><br><span class=\"line-number\">13</span><br><span class=\"line-number\">14</span><br></div></div><h2 id=\"需要配置哪些\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#需要配置哪些\" aria-hidden=\"true\">#</a> 需要配置哪些</h2>\n<h3 id=\"服务详情\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#服务详情\" aria-hidden=\"true\">#</a> 服务详情</h3>\n<p>基本信息\n上线门禁\n组件安全扫描</p>\n<h3 id=\"部署模板\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#部署模板\" aria-hidden=\"true\">#</a> 部署模板</h3>\n<p>发布脚本： 编译脚本  滚动脚本  灰度脚本  启停脚本 下发脚本  初始化脚本  巡检脚本  yaml配置\nPrepare脚本</p>\n<h3 id=\"服务器绑定\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#服务器绑定\" aria-hidden=\"true\">#</a> 服务器绑定</h3>\n<p>未绑定服务器\n已绑定服务器</p>\n<h3 id=\"日志提取\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#日志提取\" aria-hidden=\"true\">#</a> 日志提取</h3>\n<p>选择服务器，输入服务器文件地址</p>\n<h3 id=\"权限管理\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#权限管理\" aria-hidden=\"true\">#</a> 权限管理</h3>\n<p>分模块管理权限</p>\n","import { ssrRender } from \"./build-script.html.vue?vue&type=template&id=90ebaaba\"\nconst script = {}\nimport { ssrContextKey } from 'vue'\nscript.ssrRender = (...args) => {\n  const ssrContext = args[2].appContext.provides[ssrContextKey]\n  ssrContext._registeredComponents.add(\"D:\\\\yaomin\\\\WorkSpace\\\\yaomin_java2\\\\node_modules\\\\@vuepress\\\\bundler-webpack\\\\lib\\\\build\\\\ssr\\\\vuepressLoader.js!D:\\\\yaomin\\\\WorkSpace\\\\yaomin_java2\\\\node_modules\\\\vue-loader\\\\dist\\\\index.js??ruleSet[0].use[1]!D:\\\\yaomin\\\\WorkSpace\\\\yaomin_java2\\\\docs\\\\.vuepress\\\\.temp\\\\pages\\\\devops\\\\build-script.html.vue\")\n  return ssrRender(...args)\n}\n\n\nexport default script"],"names":[],"sourceRoot":""}