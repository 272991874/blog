{"version":3,"file":"2749.app.js","mappings":";;;;;;;;;;;;AAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;EC/EA;EAAA,uEACmD,EAAE,EAAC,cAAc;IADpE,mCACuC,CAAqD;UAD5F;QAAA;;;UAAA,kCACqE,YAAU;;;;IAD/E;;EAAA;EAAA,uEACiH,EAAE,EAAC,WAAW;IAD/H,mCACqG,CAAgD;UADrJ;QAAA;;;UAAA,kCACgI,UAAQ;;;;IADxI;;EAAA;EAAA,uEAC0K,EAAE,EAAC,cAAc;IAD3L,mCAC8J,CAAqD;UADnN;QAAA;;;UAAA,kCAC4L,YAAU;;;;IADtM;;EAAA;EAAA,uEACuO,EAAE,EAAC,OAAO;IADjP,mCAC2N,CAAyC;UADpQ;QAAA;;;UAAA,kCACkP,OAAK;;;;IADvP;;EAAA;EAAA,uEACyR,EAAE,EAAC,OAAO;IADnS,mCAC6Q,CAAyC;UADtT;QAAA;;;UAAA,kCACoS,OAAK;;;;IADzS;;EAAA;EAAA,uEACqV,EAAE,EAAC,YAAY;IADpW,mCACyU,CAAiD;UAD1X;QAAA;;;UAAA,kCACqW,UAAQ;;;;IAD7W;;EAAA;EAAA,uEAC+Y,EAAE,EAAC,eAAe;IADja,mCACmY,CAAuD;UAD1b;QAAA;;;UAAA,kCACka,aAAW;;;;IAD7a;;EAAA;EAAA,uEAC+c,EAAE,EAAC,cAAc;IADhe,mCACmc,CAAqD;UADxf;QAAA;;;UAAA,kCACie,YAAU;;;;IAD3e;;EAAA;EAAA,uEAC4gB,EAAE,EAAC,aAAa;IAD5hB,mCACggB,CAAoD;UADpjB;QAAA;;;UAAA,kCAC6hB,YAAU;;;;IADviB;;EAAA;;;;;;;;IAAA,mCAiDM,KAAG,EAAEA,cAAS;;;;;IAjDpB,mCAqD2K,KAAG,EAAEA,cAAS;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IArDzL,mCAgPM,KAAG,EAAEA,cAAS;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AEhPgE;AACpF;AACA,CAAmC;AACnC;AACA,iDAAiD,2BAAa;AAC9D;AACA,SAAS,SAAS;AAClB;;;AAGA,2DAAe","sources":["webpack://yaomin/./docs/.vuepress/.temp/pages/java/java_jvm_tuning.html.js","webpack://yaomin/./docs/.vuepress/.temp/pages/java/java_jvm_tuning.html.vue","webpack://yaomin/./docs/.vuepress/.temp/pages/java/java_jvm_tuning.html.vue?f038","webpack://yaomin/./docs/.vuepress/.temp/pages/java/java_jvm_tuning.html.vue?86f1"],"sourcesContent":["export const data = {\n  \"key\": \"v-47b7d17d\",\n  \"path\": \"/java/java_jvm_tuning.html\",\n  \"title\": \"jvm调优\",\n  \"lang\": \"zh-CN\",\n  \"frontmatter\": {\n    \"title\": \"jvm调优\",\n    \"sidebar\": \"auto\",\n    \"sidebarDepth\": 2\n  },\n  \"excerpt\": \"\",\n  \"headers\": [\n    {\n      \"level\": 2,\n      \"title\": \"1 调优前的基础概念\",\n      \"slug\": \"_1-调优前的基础概念\",\n      \"children\": []\n    },\n    {\n      \"level\": 2,\n      \"title\": \"2 什么是调优？\",\n      \"slug\": \"_2-什么是调优\",\n      \"children\": []\n    },\n    {\n      \"level\": 2,\n      \"title\": \"3 调优，从规划开始\",\n      \"slug\": \"_3-调优-从规划开始\",\n      \"children\": [\n        {\n          \"level\": 3,\n          \"title\": \"规划步骤：\",\n          \"slug\": \"规划步骤\",\n          \"children\": []\n        },\n        {\n          \"level\": 3,\n          \"title\": \"优化环境：\",\n          \"slug\": \"优化环境\",\n          \"children\": []\n        }\n      ]\n    },\n    {\n      \"level\": 2,\n      \"title\": \"3.1 日志详解\",\n      \"slug\": \"_3-1-日志详解\",\n      \"children\": []\n    },\n    {\n      \"level\": 2,\n      \"title\": \"3.2 CMS日志分析\",\n      \"slug\": \"_3-2-cms日志分析\",\n      \"children\": []\n    },\n    {\n      \"level\": 2,\n      \"title\": \"3.3 G1日志详解\",\n      \"slug\": \"_3-3-g1日志详解\",\n      \"children\": [\n        {\n          \"level\": 3,\n          \"title\": \"OOM产生的问题汇总\",\n          \"slug\": \"oom产生的问题汇总\",\n          \"children\": []\n        }\n      ]\n    }\n  ],\n  \"filePathRelative\": \"java/java_jvm_tuning.md\",\n  \"git\": {\n    \"contributors\": [\n      {\n        \"name\": \"yaomin\",\n        \"email\": \"272991874@qq.com\",\n        \"commits\": 3\n      }\n    ]\n  }\n}\n","<h1 id=\"jvm调优\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#jvm调优\" aria-hidden=\"true\">#</a> jvm调优</h1>\n<nav class=\"table-of-contents\"><ul><li><RouterLink to=\"#_1-调优前的基础概念\">1 调优前的基础概念</RouterLink></li><li><RouterLink to=\"#_2-什么是调优\">2 什么是调优？</RouterLink></li><li><RouterLink to=\"#_3-调优-从规划开始\">3 调优，从规划开始</RouterLink><ul><li><RouterLink to=\"#规划步骤\">规划步骤：</RouterLink></li><li><RouterLink to=\"#优化环境\">优化环境：</RouterLink></li></ul></li><li><RouterLink to=\"#_3-1-日志详解\">3.1 日志详解</RouterLink></li><li><RouterLink to=\"#_3-2-cms日志分析\">3.2 CMS日志分析</RouterLink></li><li><RouterLink to=\"#_3-3-g1日志详解\">3.3 G1日志详解</RouterLink><ul><li><RouterLink to=\"#oom产生的问题汇总\">OOM产生的问题汇总</RouterLink></li></ul></li></ul></nav>\n<h2 id=\"_1-调优前的基础概念\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-调优前的基础概念\" aria-hidden=\"true\">#</a> 1 调优前的基础概念</h2>\n<p>吞吐量：用户代码执行时间 / (垃圾回收时间 + 用户代码执行时间)<br>\n响应时间：STW时间越短，响应时间越好<br>\n所谓调优，首先确定，追求啥？吞吐量优先，还是响应时间优先？还是在满足一定的响应时间的情况下，要求达到多大的吞吐量…<br>\n吞吐量优先：科学计算，吞吐量。数据挖掘，thrput。（PS + PO）<br>\n响应时间优先：网站 GUI API （1.8 G1）</p>\n<h2 id=\"_2-什么是调优\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-什么是调优\" aria-hidden=\"true\">#</a> 2 什么是调优？</h2>\n<p>根据需求进行JVM规划和预调优<br>\n优化运行JVM运行环境（慢，卡顿）<br>\n解决JVM运行过程中出现的各种问题(OOM)</p>\n<h2 id=\"_3-调优-从规划开始\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-调优-从规划开始\" aria-hidden=\"true\">#</a> 3 调优，从规划开始</h2>\n<p>调优，从业务场景开始，没有业务场景的调优都是耍流氓<br>\n无监控（压力测试，能看到结果），不调优</p>\n<h3 id=\"规划步骤\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#规划步骤\" aria-hidden=\"true\">#</a> 规划步骤：</h3>\n<p>熟悉业务场景（没有最好的垃圾回收器，只有最合适的垃圾回收器）<br>\n响应时间、停顿时间 [CMS G1 ZGC] （需要给用户作响应）<br>\n吞吐量 = 用户时间 /( 用户时间 + GC时间) [PS]<br>\n选择回收器组合<br>\n计算内存需求（经验值 1.5G 16G）<br>\n选定CPU（越高越好）<br>\n设定年代大小、升级年龄<br>\n设定日志参数或者每天产生一个日志文件</p>\n<div class=\"language-bash ext-sh line-numbers-mode\"><pre v-pre class=\"language-bash\"><code>-Xloggc:/opt/xxx/logs/xxx-xxx-gc-%t.log <span class=\"token punctuation\">\\</span>\n-XX:+UseGCLogFileRotation <span class=\"token punctuation\">\\</span>\n-XX:NumberOfGCLogFiles<span class=\"token operator\">=</span><span class=\"token number\">5</span> <span class=\"token punctuation\">\\</span>\n-XX:GCLogFileSize<span class=\"token operator\">=</span>20M <span class=\"token punctuation\">\\</span>\n-XX:+PrintGCDetails <span class=\"token punctuation\">\\</span>\n-XX:+PrintGCDateStamps <span class=\"token punctuation\">\\</span>\n-XX:+PrintGCCause\n</code></pre><div class=\"line-numbers\"><span class=\"line-number\">1</span><br><span class=\"line-number\">2</span><br><span class=\"line-number\">3</span><br><span class=\"line-number\">4</span><br><span class=\"line-number\">5</span><br><span class=\"line-number\">6</span><br><span class=\"line-number\">7</span><br></div></div><p>观察日志情况</p>\n<h3 id=\"优化环境\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#优化环境\" aria-hidden=\"true\">#</a> 优化环境：</h3>\n<p>1.有一个50万PV的资料类网站（从磁盘提取文档到内存）原服务器32位，1.5G 的堆，用户反馈网站比较缓慢，因此公司决定升级，新的服务器为64位，16G 的堆内存，结果用户反馈卡顿十分严重，反而比以前效率更低了\n为什么原网站慢? 很多用户浏览数据，很多数据load到内存，内存不足，频繁GC，STW长，响应时间变慢\n为什么会更卡顿？ 内存越大，FGC时间越长<br>\n咋办？ PS -&gt; PN + CMS 或者 G1<br>\n2.系统CPU经常100%，如何调优？(面试高频) CPU100%那么一定有线程在占用系统资源，\n找出哪个进程cpu高（top）<br>\n该进程中的哪个线程cpu高（top -Hp）<br>\n导出该线程的堆栈 (jstack)<br>\n查找哪个方法（栈帧）消耗时间 (jstack)<br>\n工作线程占比高 | 垃圾回收线程占比高<br>\n3.系统内存飙高，如何查找问题？（面试高频）<br>\n导出堆内存 (jmap)\n分析 (jhat jvisualvm mat jprofiler … )<br>\n4.如何监控JVM\njstat jvisualvm jprofiler arthas top…</p>\n<h2 id=\"_3-1-日志详解\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-1-日志详解\" aria-hidden=\"true\">#</a> 3.1 日志详解</h2>\n<img :src=\"$withBase('/images/gc-log.jpg')\" alt=\"hashcode\">\n<div class=\"language-bash ext-sh line-numbers-mode\"><pre v-pre class=\"language-bash\"><code>eden space 5632K, <span class=\"token number\">94</span>% used\n<span class=\"token punctuation\">[</span>0x00000000ff980000 , 0x00000000ffeb3e28 , 0x00000000fff00000<span class=\"token punctuation\">)</span>\n<span class=\"token comment\">#起始地址 ，使用空间结束地址 ，整体空间结束地址</span>\n</code></pre><div class=\"line-numbers\"><span class=\"line-number\">1</span><br><span class=\"line-number\">2</span><br><span class=\"line-number\">3</span><br></div></div><img :src=\"$withBase('/images/gc-log-heap.jpg')\" alt=\"hashcode\">\n<h2 id=\"_3-2-cms日志分析\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-2-cms日志分析\" aria-hidden=\"true\">#</a> 3.2 CMS日志分析</h2>\n<p>执行命令</p>\n<div class=\"language-bash ext-sh line-numbers-mode\"><pre v-pre class=\"language-bash\"><code>java <span class=\"token punctuation\">\\</span>\n-Xms20M <span class=\"token punctuation\">\\</span>\n-Xmx20M <span class=\"token punctuation\">\\</span>\n-XX:+PrintGCDetails <span class=\"token punctuation\">\\</span>\n-XX:+UseConcMarkSweepGC <span class=\"token punctuation\">\\</span>\ncom.jvm.gc.Problem01\n\n<span class=\"token punctuation\">[</span>GC <span class=\"token punctuation\">(</span>Allocation Failure<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span>ParNew: 6144K-<span class=\"token operator\">></span>640K<span class=\"token punctuation\">(</span>6144K<span class=\"token punctuation\">)</span>, <span class=\"token number\">0.0265885</span> secs<span class=\"token punctuation\">]</span> 6585K-<span class=\"token operator\">></span>2770K<span class=\"token punctuation\">(</span>19840K<span class=\"token punctuation\">)</span>, <span class=\"token number\">0.0268035</span> secs<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>Times: <span class=\"token assign-left variable\">user</span><span class=\"token operator\">=</span><span class=\"token number\">0.02</span> <span class=\"token assign-left variable\">sys</span><span class=\"token operator\">=</span><span class=\"token number\">0.00</span>, <span class=\"token assign-left variable\">real</span><span class=\"token operator\">=</span><span class=\"token number\">0.02</span> secs<span class=\"token punctuation\">]</span>\n</code></pre><div class=\"line-numbers\"><span class=\"line-number\">1</span><br><span class=\"line-number\">2</span><br><span class=\"line-number\">3</span><br><span class=\"line-number\">4</span><br><span class=\"line-number\">5</span><br><span class=\"line-number\">6</span><br><span class=\"line-number\">7</span><br><span class=\"line-number\">8</span><br></div></div><p>ParNew：年轻代收集器<br>\n6144-&gt;640：收集前后的对比<br>\n（6144）：整个年轻代容量<br>\n6585 -&gt; 2770：整个堆的情况<br>\n（19840）：整个堆大小</p>\n<div class=\"language-bash ext-sh line-numbers-mode\"><pre v-pre class=\"language-bash\"><code><span class=\"token punctuation\">[</span>GC <span class=\"token punctuation\">(</span>CMS Initial Mark<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span> CMS-initial-mark: 8511K<span class=\"token punctuation\">(</span>13696K<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span> 9866K<span class=\"token punctuation\">(</span>19840K<span class=\"token punctuation\">)</span>, <span class=\"token number\">0.0040321</span> secs<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>Times: <span class=\"token assign-left variable\">user</span><span class=\"token operator\">=</span><span class=\"token number\">0.01</span> <span class=\"token assign-left variable\">sys</span><span class=\"token operator\">=</span><span class=\"token number\">0.00</span>, <span class=\"token assign-left variable\">real</span><span class=\"token operator\">=</span><span class=\"token number\">0.00</span> secs<span class=\"token punctuation\">]</span> \n    <span class=\"token comment\">#8511 (13696) : 老年代使用（最大）</span>\n    <span class=\"token comment\">#9866 (19840) : 整个堆使用（最大）</span>\n<span class=\"token punctuation\">[</span>CMS-concurrent-mark-start<span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">[</span>CMS-concurrent-mark: <span class=\"token number\">0.018</span>/0.018 secs<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>Times: <span class=\"token assign-left variable\">user</span><span class=\"token operator\">=</span><span class=\"token number\">0.01</span> <span class=\"token assign-left variable\">sys</span><span class=\"token operator\">=</span><span class=\"token number\">0.00</span>, <span class=\"token assign-left variable\">real</span><span class=\"token operator\">=</span><span class=\"token number\">0.02</span> secs<span class=\"token punctuation\">]</span> \n    <span class=\"token comment\">#这里的时间意义不大，因为是并发执行</span>\n<span class=\"token punctuation\">[</span>CMS-concurrent-preclean-start<span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">[</span>CMS-concurrent-preclean: <span class=\"token number\">0.000</span>/0.000 secs<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>Times: <span class=\"token assign-left variable\">user</span><span class=\"token operator\">=</span><span class=\"token number\">0.00</span> <span class=\"token assign-left variable\">sys</span><span class=\"token operator\">=</span><span class=\"token number\">0.00</span>, <span class=\"token assign-left variable\">real</span><span class=\"token operator\">=</span><span class=\"token number\">0.00</span> secs<span class=\"token punctuation\">]</span> \n    <span class=\"token comment\">#标记Card为Dirty，也称为Card Marking</span>\n<span class=\"token punctuation\">[</span>GC <span class=\"token punctuation\">(</span>CMS Final Remark<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span>YG occupancy: <span class=\"token number\">1597</span> K <span class=\"token punctuation\">(</span><span class=\"token number\">6144</span> K<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>Rescan <span class=\"token punctuation\">(</span>parallel<span class=\"token punctuation\">)</span> , <span class=\"token number\">0.0008396</span> secs<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>weak refs processing, <span class=\"token number\">0.0000138</span> secs<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>class unloading, <span class=\"token number\">0.0005404</span> secs<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>scrub symbol table, <span class=\"token number\">0.0006169</span> secs<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>scrub string table, <span class=\"token number\">0.0004903</span> secs<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span> CMS-remark: 8511K<span class=\"token punctuation\">(</span>13696K<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span> 10108K<span class=\"token punctuation\">(</span>19840K<span class=\"token punctuation\">)</span>, <span class=\"token number\">0.0039567</span> secs<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>Times: <span class=\"token assign-left variable\">user</span><span class=\"token operator\">=</span><span class=\"token number\">0.00</span> <span class=\"token assign-left variable\">sys</span><span class=\"token operator\">=</span><span class=\"token number\">0.00</span>, <span class=\"token assign-left variable\">real</span><span class=\"token operator\">=</span><span class=\"token number\">0.00</span> secs<span class=\"token punctuation\">]</span> \n    <span class=\"token comment\">#STW阶段，YG occupancy:年轻代占用及容量</span>\n    <span class=\"token comment\">#[Rescan (parallel)：STW下的存活对象标记</span>\n    <span class=\"token comment\">#weak refs processing: 弱引用处理</span>\n    <span class=\"token comment\">#class unloading: 卸载用不到的class</span>\n    <span class=\"token comment\">#scrub symbol(string) table: </span>\n        <span class=\"token comment\">#cleaning up symbol and string tables which hold class-level metadata and </span>\n        <span class=\"token comment\">#internalized string respectively</span>\n    <span class=\"token comment\">#CMS-remark: 8511K(13696K): 阶段过后的老年代占用及容量</span>\n    <span class=\"token comment\">#10108K(19840K): 阶段过后的堆占用及容量</span>\n\n<span class=\"token punctuation\">[</span>CMS-concurrent-sweep-start<span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">[</span>CMS-concurrent-sweep: <span class=\"token number\">0.005</span>/0.005 secs<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>Times: <span class=\"token assign-left variable\">user</span><span class=\"token operator\">=</span><span class=\"token number\">0.00</span> <span class=\"token assign-left variable\">sys</span><span class=\"token operator\">=</span><span class=\"token number\">0.00</span>, <span class=\"token assign-left variable\">real</span><span class=\"token operator\">=</span><span class=\"token number\">0.01</span> secs<span class=\"token punctuation\">]</span> \n    <span class=\"token comment\">#标记已经完成，进行并发清理</span>\n<span class=\"token punctuation\">[</span>CMS-concurrent-reset-start<span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">[</span>CMS-concurrent-reset: <span class=\"token number\">0.000</span>/0.000 secs<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>Times: <span class=\"token assign-left variable\">user</span><span class=\"token operator\">=</span><span class=\"token number\">0.00</span> <span class=\"token assign-left variable\">sys</span><span class=\"token operator\">=</span><span class=\"token number\">0.00</span>, <span class=\"token assign-left variable\">real</span><span class=\"token operator\">=</span><span class=\"token number\">0.00</span> secs<span class=\"token punctuation\">]</span>\n    <span class=\"token comment\">#重置内部结构，为下次GC做准备</span>\n</code></pre><div class=\"line-numbers\"><span class=\"line-number\">1</span><br><span class=\"line-number\">2</span><br><span class=\"line-number\">3</span><br><span class=\"line-number\">4</span><br><span class=\"line-number\">5</span><br><span class=\"line-number\">6</span><br><span class=\"line-number\">7</span><br><span class=\"line-number\">8</span><br><span class=\"line-number\">9</span><br><span class=\"line-number\">10</span><br><span class=\"line-number\">11</span><br><span class=\"line-number\">12</span><br><span class=\"line-number\">13</span><br><span class=\"line-number\">14</span><br><span class=\"line-number\">15</span><br><span class=\"line-number\">16</span><br><span class=\"line-number\">17</span><br><span class=\"line-number\">18</span><br><span class=\"line-number\">19</span><br><span class=\"line-number\">20</span><br><span class=\"line-number\">21</span><br><span class=\"line-number\">22</span><br><span class=\"line-number\">23</span><br><span class=\"line-number\">24</span><br><span class=\"line-number\">25</span><br><span class=\"line-number\">26</span><br></div></div><h2 id=\"_3-3-g1日志详解\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-3-g1日志详解\" aria-hidden=\"true\">#</a> 3.3 G1日志详解</h2>\n<div class=\"language-bash ext-sh line-numbers-mode\"><pre v-pre class=\"language-bash\"><code><span class=\"token punctuation\">[</span>GC pause <span class=\"token punctuation\">(</span>G1 Evacuation Pause<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span>young<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span>initial-mark<span class=\"token punctuation\">)</span>, <span class=\"token number\">0.0015790</span> secs<span class=\"token punctuation\">]</span>\n<span class=\"token comment\">#young -> 年轻代 Evacuation-> 复制存活对象 </span>\n<span class=\"token comment\">#initial-mark 混合回收的阶段，这里是YGC混合老年代回收</span>\n   <span class=\"token punctuation\">[</span>Parallel Time: <span class=\"token number\">1.5</span> ms, GC Workers: <span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token comment\">#一个GC线程</span>\n      <span class=\"token punctuation\">[</span>GC Worker Start <span class=\"token punctuation\">(</span>ms<span class=\"token punctuation\">)</span>:  <span class=\"token number\">92635.7</span><span class=\"token punctuation\">]</span>\n      <span class=\"token punctuation\">[</span>Ext Root Scanning <span class=\"token punctuation\">(</span>ms<span class=\"token punctuation\">)</span>:  <span class=\"token number\">1.1</span><span class=\"token punctuation\">]</span>\n      <span class=\"token punctuation\">[</span>Update RS <span class=\"token punctuation\">(</span>ms<span class=\"token punctuation\">)</span>:  <span class=\"token number\">0.0</span><span class=\"token punctuation\">]</span>\n         <span class=\"token punctuation\">[</span>Processed Buffers:  <span class=\"token number\">1</span><span class=\"token punctuation\">]</span>\n      <span class=\"token punctuation\">[</span>Scan RS <span class=\"token punctuation\">(</span>ms<span class=\"token punctuation\">)</span>:  <span class=\"token number\">0.0</span><span class=\"token punctuation\">]</span>\n      <span class=\"token punctuation\">[</span>Code Root Scanning <span class=\"token punctuation\">(</span>ms<span class=\"token punctuation\">)</span>:  <span class=\"token number\">0.0</span><span class=\"token punctuation\">]</span>\n      <span class=\"token punctuation\">[</span>Object Copy <span class=\"token punctuation\">(</span>ms<span class=\"token punctuation\">)</span>:  <span class=\"token number\">0.1</span><span class=\"token punctuation\">]</span>\n      <span class=\"token punctuation\">[</span>Termination <span class=\"token punctuation\">(</span>ms<span class=\"token punctuation\">)</span>:  <span class=\"token number\">0.0</span><span class=\"token punctuation\">]</span>\n         <span class=\"token punctuation\">[</span>Termination Attempts:  <span class=\"token number\">1</span><span class=\"token punctuation\">]</span>\n      <span class=\"token punctuation\">[</span>GC Worker Other <span class=\"token punctuation\">(</span>ms<span class=\"token punctuation\">)</span>:  <span class=\"token number\">0.0</span><span class=\"token punctuation\">]</span>\n      <span class=\"token punctuation\">[</span>GC Worker Total <span class=\"token punctuation\">(</span>ms<span class=\"token punctuation\">)</span>:  <span class=\"token number\">1.2</span><span class=\"token punctuation\">]</span>\n      <span class=\"token punctuation\">[</span>GC Worker End <span class=\"token punctuation\">(</span>ms<span class=\"token punctuation\">)</span>:  <span class=\"token number\">92636.9</span><span class=\"token punctuation\">]</span>\n   <span class=\"token punctuation\">[</span>Code Root Fixup: <span class=\"token number\">0.0</span> ms<span class=\"token punctuation\">]</span>\n   <span class=\"token punctuation\">[</span>Code Root Purge: <span class=\"token number\">0.0</span> ms<span class=\"token punctuation\">]</span>\n   <span class=\"token punctuation\">[</span>Clear CT: <span class=\"token number\">0.0</span> ms<span class=\"token punctuation\">]</span>\n   <span class=\"token punctuation\">[</span>Other: <span class=\"token number\">0.1</span> ms<span class=\"token punctuation\">]</span>\n      <span class=\"token punctuation\">[</span>Choose CSet: <span class=\"token number\">0.0</span> ms<span class=\"token punctuation\">]</span>\n      <span class=\"token punctuation\">[</span>Ref Proc: <span class=\"token number\">0.0</span> ms<span class=\"token punctuation\">]</span>\n      <span class=\"token punctuation\">[</span>Ref Enq: <span class=\"token number\">0.0</span> ms<span class=\"token punctuation\">]</span>\n      <span class=\"token punctuation\">[</span>Redirty Cards: <span class=\"token number\">0.0</span> ms<span class=\"token punctuation\">]</span>\n      <span class=\"token punctuation\">[</span>Humongous Register: <span class=\"token number\">0.0</span> ms<span class=\"token punctuation\">]</span>\n      <span class=\"token punctuation\">[</span>Humongous Reclaim: <span class=\"token number\">0.0</span> ms<span class=\"token punctuation\">]</span>\n      <span class=\"token punctuation\">[</span>Free CSet: <span class=\"token number\">0.0</span> ms<span class=\"token punctuation\">]</span>\n   <span class=\"token punctuation\">[</span>Eden: <span class=\"token number\">0</span>.0B<span class=\"token punctuation\">(</span><span class=\"token number\">1024</span>.0K<span class=\"token punctuation\">)</span>-<span class=\"token operator\">></span><span class=\"token number\">0</span>.0B<span class=\"token punctuation\">(</span><span class=\"token number\">1024</span>.0K<span class=\"token punctuation\">)</span> Survivors: <span class=\"token number\">0</span>.0B-<span class=\"token operator\">></span><span class=\"token number\">0</span>.0B Heap: <span class=\"token number\">18</span>.8M<span class=\"token punctuation\">(</span><span class=\"token number\">20</span>.0M<span class=\"token punctuation\">)</span>-<span class=\"token operator\">></span><span class=\"token number\">18</span>.8M<span class=\"token punctuation\">(</span><span class=\"token number\">20</span>.0M<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n <span class=\"token punctuation\">[</span>Times: <span class=\"token assign-left variable\">user</span><span class=\"token operator\">=</span><span class=\"token number\">0.00</span> <span class=\"token assign-left variable\">sys</span><span class=\"token operator\">=</span><span class=\"token number\">0.00</span>, <span class=\"token assign-left variable\">real</span><span class=\"token operator\">=</span><span class=\"token number\">0.00</span> secs<span class=\"token punctuation\">]</span> \n<span class=\"token comment\">#以下是混合回收其他阶段</span>\n<span class=\"token punctuation\">[</span>GC concurrent-root-region-scan-start<span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">[</span>GC concurrent-root-region-scan-end, <span class=\"token number\">0.0000078</span> secs<span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">[</span>GC concurrent-mark-start<span class=\"token punctuation\">]</span>\n<span class=\"token comment\">#无法evacuation，进行FGC</span>\n<span class=\"token punctuation\">[</span>Full GC <span class=\"token punctuation\">(</span>Allocation Failure<span class=\"token punctuation\">)</span>  18M-<span class=\"token operator\">></span>18M<span class=\"token punctuation\">(</span>20M<span class=\"token punctuation\">)</span>, <span class=\"token number\">0.0719656</span> secs<span class=\"token punctuation\">]</span>\n   <span class=\"token punctuation\">[</span>Eden: <span class=\"token number\">0</span>.0B<span class=\"token punctuation\">(</span><span class=\"token number\">1024</span>.0K<span class=\"token punctuation\">)</span>-<span class=\"token operator\">></span><span class=\"token number\">0</span>.0B<span class=\"token punctuation\">(</span><span class=\"token number\">1024</span>.0K<span class=\"token punctuation\">)</span> Survivors: <span class=\"token number\">0</span>.0B-<span class=\"token operator\">></span><span class=\"token number\">0</span>.0B Heap: <span class=\"token number\">18</span>.8M<span class=\"token punctuation\">(</span><span class=\"token number\">20</span>.0M<span class=\"token punctuation\">)</span>-<span class=\"token operator\">></span><span class=\"token number\">18</span>.8M<span class=\"token punctuation\">(</span><span class=\"token number\">20</span>.0M<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>, <span class=\"token punctuation\">[</span>Metaspace: <span class=\"token number\">38</span>\n76K-<span class=\"token operator\">></span>3876K<span class=\"token punctuation\">(</span>1056768K<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>Times: <span class=\"token assign-left variable\">user</span><span class=\"token operator\">=</span><span class=\"token number\">0.07</span> <span class=\"token assign-left variable\">sys</span><span class=\"token operator\">=</span><span class=\"token number\">0.00</span>, <span class=\"token assign-left variable\">real</span><span class=\"token operator\">=</span><span class=\"token number\">0.07</span> secs<span class=\"token punctuation\">]</span>\n</code></pre><div class=\"line-numbers\"><span class=\"line-number\">1</span><br><span class=\"line-number\">2</span><br><span class=\"line-number\">3</span><br><span class=\"line-number\">4</span><br><span class=\"line-number\">5</span><br><span class=\"line-number\">6</span><br><span class=\"line-number\">7</span><br><span class=\"line-number\">8</span><br><span class=\"line-number\">9</span><br><span class=\"line-number\">10</span><br><span class=\"line-number\">11</span><br><span class=\"line-number\">12</span><br><span class=\"line-number\">13</span><br><span class=\"line-number\">14</span><br><span class=\"line-number\">15</span><br><span class=\"line-number\">16</span><br><span class=\"line-number\">17</span><br><span class=\"line-number\">18</span><br><span class=\"line-number\">19</span><br><span class=\"line-number\">20</span><br><span class=\"line-number\">21</span><br><span class=\"line-number\">22</span><br><span class=\"line-number\">23</span><br><span class=\"line-number\">24</span><br><span class=\"line-number\">25</span><br><span class=\"line-number\">26</span><br><span class=\"line-number\">27</span><br><span class=\"line-number\">28</span><br><span class=\"line-number\">29</span><br><span class=\"line-number\">30</span><br><span class=\"line-number\">31</span><br><span class=\"line-number\">32</span><br><span class=\"line-number\">33</span><br><span class=\"line-number\">34</span><br><span class=\"line-number\">35</span><br><span class=\"line-number\">36</span><br><span class=\"line-number\">37</span><br></div></div><h1 id=\"_4-案例理解常用工具\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_4-案例理解常用工具\" aria-hidden=\"true\">#</a> 4 案例理解常用工具</h1>\n<div class=\"language-java ext-java line-numbers-mode\"><pre v-pre class=\"language-java\"><code><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>jvm<span class=\"token punctuation\">.</span>gc</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>math<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">BigDecimal</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ArrayList</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Date</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">List</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span>concurrent<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ScheduledThreadPoolExecutor</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span>concurrent<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ThreadPoolExecutor</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token namespace\">java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span>concurrent<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">TimeUnit</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token doc-comment comment\">/**\n * 从数据库中读取信用数据，套用模型，并把结果进行记录和传输\n */</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Problem01</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">CardInfo</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">BigDecimal</span> price <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BigDecimal</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">String</span> name <span class=\"token operator\">=</span> <span class=\"token string\">\"张三\"</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">int</span> age <span class=\"token operator\">=</span> <span class=\"token number\">5</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">Date</span> birthdate <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">m</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">ScheduledThreadPoolExecutor</span> executor <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ScheduledThreadPoolExecutor</span><span class=\"token punctuation\">(</span><span class=\"token number\">50</span><span class=\"token punctuation\">,</span>\n            <span class=\"token keyword\">new</span> <span class=\"token class-name\">ThreadPoolExecutor<span class=\"token punctuation\">.</span>DiscardOldestPolicy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>\n        executor<span class=\"token punctuation\">.</span><span class=\"token function\">setMaximumPoolSize</span><span class=\"token punctuation\">(</span><span class=\"token number\">50</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n            <span class=\"token function\">modelFit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">modelFit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">CardInfo</span><span class=\"token punctuation\">></span></span> taskList <span class=\"token operator\">=</span> <span class=\"token function\">getAllCardInfo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        taskList<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span>info <span class=\"token operator\">-></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// do something</span>\n            executor<span class=\"token punctuation\">.</span><span class=\"token function\">scheduleWithFixedDelay</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">{</span>\n                <span class=\"token comment\">//do sth with info</span>\n                info<span class=\"token punctuation\">.</span><span class=\"token function\">m</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">TimeUnit</span><span class=\"token punctuation\">.</span>SECONDS<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">CardInfo</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getAllCardInfo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">CardInfo</span><span class=\"token punctuation\">></span></span> taskList <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token number\">100</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\">CardInfo</span> ci <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">CardInfo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            taskList<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>ci<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">return</span> taskList<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n</code></pre><div class=\"line-numbers\"><span class=\"line-number\">1</span><br><span class=\"line-number\">2</span><br><span class=\"line-number\">3</span><br><span class=\"line-number\">4</span><br><span class=\"line-number\">5</span><br><span class=\"line-number\">6</span><br><span class=\"line-number\">7</span><br><span class=\"line-number\">8</span><br><span class=\"line-number\">9</span><br><span class=\"line-number\">10</span><br><span class=\"line-number\">11</span><br><span class=\"line-number\">12</span><br><span class=\"line-number\">13</span><br><span class=\"line-number\">14</span><br><span class=\"line-number\">15</span><br><span class=\"line-number\">16</span><br><span class=\"line-number\">17</span><br><span class=\"line-number\">18</span><br><span class=\"line-number\">19</span><br><span class=\"line-number\">20</span><br><span class=\"line-number\">21</span><br><span class=\"line-number\">22</span><br><span class=\"line-number\">23</span><br><span class=\"line-number\">24</span><br><span class=\"line-number\">25</span><br><span class=\"line-number\">26</span><br><span class=\"line-number\">27</span><br><span class=\"line-number\">28</span><br><span class=\"line-number\">29</span><br><span class=\"line-number\">30</span><br><span class=\"line-number\">31</span><br><span class=\"line-number\">32</span><br><span class=\"line-number\">33</span><br><span class=\"line-number\">34</span><br><span class=\"line-number\">35</span><br><span class=\"line-number\">36</span><br><span class=\"line-number\">37</span><br><span class=\"line-number\">38</span><br><span class=\"line-number\">39</span><br><span class=\"line-number\">40</span><br><span class=\"line-number\">41</span><br><span class=\"line-number\">42</span><br><span class=\"line-number\">43</span><br><span class=\"line-number\">44</span><br><span class=\"line-number\">45</span><br><span class=\"line-number\">46</span><br><span class=\"line-number\">47</span><br><span class=\"line-number\">48</span><br><span class=\"line-number\">49</span><br><span class=\"line-number\">50</span><br><span class=\"line-number\">51</span><br><span class=\"line-number\">52</span><br><span class=\"line-number\">53</span><br><span class=\"line-number\">54</span><br><span class=\"line-number\">55</span><br><span class=\"line-number\">56</span><br><span class=\"line-number\">57</span><br><span class=\"line-number\">58</span><br></div></div><div class=\"language-bash ext-sh line-numbers-mode\"><pre v-pre class=\"language-bash\"><code>java <span class=\"token punctuation\">\\</span>\n-Xms200M <span class=\"token punctuation\">\\</span>\n-Xmx200M <span class=\"token punctuation\">\\</span>\n-XX:+PrintGC <span class=\"token punctuation\">\\</span>\ncom.jvm.gc.Problem01\n</code></pre><div class=\"line-numbers\"><span class=\"line-number\">1</span><br><span class=\"line-number\">2</span><br><span class=\"line-number\">3</span><br><span class=\"line-number\">4</span><br><span class=\"line-number\">5</span><br></div></div><p>一般是运维团队首先受到报警信息（CPU Memory）<br>\ntop <strong>命令观察到问题：内存不断增长 CPU占用率居高不下</strong><br>\ntop -Hp [pid] 观察进程中的线程，哪个线程CPU和内存占比高<br>\n**jps 定位具体java进程 **<br>\njstack [pid] 定位线程状况，重点关注：WAITING BLOCKED\neg. waiting on &lt;0x0000000088ca3310&gt; (a java.lang.Object)\n假如有一个进程中100个线程，很多线程都在waiting on ，一定要找到是哪个线程持有这把锁\n怎么找？搜索jstack dump的信息，找 ，看哪个线程持有这把锁RUNNABLE\n阿里规范里规定，线程的名称（尤其是线程池）都要写有意义的名称\n怎么样自定义线程池里的线程名称？（自定义ThreadFactory）<br>\njinfo [pid]列出详细信息如启动参数<br>\njstat -gc [pid][time] 打印GC信息,动态观察GC情况<br>\n定位OOM问题</p>\n<p>jconsole 链接<br>\n程序启动加入参数：</p>\n<div class=\"language-bash ext-sh line-numbers-mode\"><pre v-pre class=\"language-bash\"><code>java -Djava.rmi.server.hostname<span class=\"token operator\">=</span><span class=\"token number\">192.168</span>.17.11 <span class=\"token punctuation\">\\</span>\n-Dcom.sun.management.jmxremote <span class=\"token punctuation\">\\</span>\n-Dcom.sun.management.jmxremote.port<span class=\"token operator\">=</span><span class=\"token number\">11111</span> <span class=\"token punctuation\">\\</span>\n-Dcom.sun.management.jmxremote.authenticate<span class=\"token operator\">=</span>false <span class=\"token punctuation\">\\</span>\n-Dcom.sun.management.jmxremote.ssl<span class=\"token operator\">=</span>false <span class=\"token punctuation\">\\</span>\nxxxxxx.jar\n</code></pre><div class=\"line-numbers\"><span class=\"line-number\">1</span><br><span class=\"line-number\">2</span><br><span class=\"line-number\">3</span><br><span class=\"line-number\">4</span><br><span class=\"line-number\">5</span><br><span class=\"line-number\">6</span><br></div></div><p>如果遭遇 Local host name unknown：XXX的错误，修改/etc/hosts文件，把XXX加入进去</p>\n<div class=\"language-bash ext-sh line-numbers-mode\"><pre v-pre class=\"language-bash\"><code><span class=\"token number\">192.168</span>.17.11 basic localhost localhost.localdomain localhost4 localhost4.localdomain4\n::1         localhost localhost.localdomain localhost6 localhost6.localdomain6\n</code></pre><div class=\"line-numbers\"><span class=\"line-number\">1</span><br><span class=\"line-number\">2</span><br></div></div><p>关闭linux防火墙（生产环境中应该打开对应端口）</p>\n<div class=\"language-bash ext-sh line-numbers-mode\"><pre v-pre class=\"language-bash\"><code><span class=\"token function\">service</span> iptables stop\n<span class=\"token function\">chkconfig</span> iptables off <span class=\"token comment\">#永久关闭</span>\n</code></pre><div class=\"line-numbers\"><span class=\"line-number\">1</span><br><span class=\"line-number\">2</span><br></div></div><p>jvisualVM : jvisualVM用法<br>\nJprofiler 收费<br>\narthas – 阿里巴巴开源的 Java 诊断工具<br>\n为什么需要在线排查？ 在生产上我们经常会碰到一些不好排查的问题，例如线程安全问题，用最简单的threaddump或者heapdump不好查到问题原因。为了排查这些问题，有时我们会临时加一些日志，比如在一些关键的函数里打印出入参，然后重新打包发布，如果打了日志还是没找到问题，继续加日志，重新打包发布。对于上线流程复杂而且审核比较严的公司，从改代码到上线需要层层的流转，会大大影响问题排查的进度。<br>\njvm观察jvm信息<br>\nthread定位线程问题<br>\ndashboard 观察系统情况<br>\nheapdump + jhat分析<br>\njad反编译 动态代理生成类的问题定位 第三方的类（观察代码） 版本问题（确定自己最新提交的版本是不是被使用）<br>\nredefine 热替换 目前有些限制条件：只能改方法实现（方法已经运行完成），不能改方法名， 不能改属性 m() -&gt; mm()<br>\nsc – search class<br>\nwatch – watch method<br>\n没有包含的功能：jmap<br>\n已经上线的系统不用图形界面用什么？（cmdline arthas）<br>\n图形界面到底用在什么地方？测试的时候进行监控（压测观察）</p>\n<p>jmap – 输出所有内存中对象的工具，甚至可以将VM 中的heap，以二进制输出成文本\n<img :src=\"$withBase('/images/jvm-jmap.jpg')\" alt=\"hashcode\"></p>\n<h4 id=\"参数\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#参数\" aria-hidden=\"true\">#</a> 参数：</h4>\n<p>option： 选项参数。<br>\npid： 需要打印配置信息的进程ID。<br>\nexecutable： 产生核心dump的Java可执行文件。<br>\ncore： 需要打印配置信息的核心文件。<br>\nserver-id 可选的唯一id，如果相同的远程主机上运行了多台调试服务器，用此选项参数标识服务器。<br>\nremote server IP or hostname 远程调试服务器的IP地址或主机名。</p>\n<h4 id=\"option\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#option\" aria-hidden=\"true\">#</a> option</h4>\n<p>no option： 查看进程的内存映像信息,类似 Solaris pmap 命令。<br>\nheap： 显示Java堆详细信息<br>\nhisto[:live]： 显示堆中对象的统计信息<br>\nclstats：打印类加载器信息<br>\nfinalizerinfo： 显示在F-Queue队列等待Finalizer线程执行finalizer方法的对象<br>\ndump:：生成堆转储快照<br>\nF： 当-dump没有响应时，使用-dump或者-histo参数. 在这个模式下,live子参数无效.<br>\nhelp：打印帮助信息<br>\nJ：指定传递给运行jmap的JVM的参数</p>\n<h4 id=\"示例\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#示例\" aria-hidden=\"true\">#</a> 示例</h4>\n<p>jmap histo [pid] ，显示堆中对象的统计信息<br>\njmap -dump:format=b,file=xxx pid ：<br>\n线上系统，内存特别大，jmap执行期间会对进程产生很大影响，甚至卡顿（电商不适合）</p>\n<p>设定了参数HeapDump，OOM的时候会自动产生堆转储文件<br>\n很多服务器备份（高可用），停掉这台服务器对其他服务器不影响<br>\n在线定位(一般小点儿公司用不到)</p>\n<div class=\"language-bash ext-sh line-numbers-mode\"><pre v-pre class=\"language-bash\"><code>java \n-Xms20M \n-Xmx20M \n-XX:+UseParallelGC \n-XX:+HeapDumpOnOutOfMemoryError \ncom.jvm.gc.Problem01\n</code></pre><div class=\"line-numbers\"><span class=\"line-number\">1</span><br><span class=\"line-number\">2</span><br><span class=\"line-number\">3</span><br><span class=\"line-number\">4</span><br><span class=\"line-number\">5</span><br><span class=\"line-number\">6</span><br></div></div><p>使用MAT / jhat /jvisualvm 进行dump文件分析<br>\nhttps://www.cnblogs.com/baihuitestsoftware/articles/6406271.html<br>\njhat -J-mx512M xxx.dump http://192.168.17.11:7000<br>\n拉到最后：找到对应链接 可以使用OQL查找特定问题对象<br>\n找到代码的问题</p>\n<h3 id=\"oom产生的问题汇总\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#oom产生的问题汇总\" aria-hidden=\"true\">#</a> OOM产生的问题汇总</h3>\n<p>OOM产生的原因多种多样，有些程序未必产生OOM，不断FGC(CPU飙高，但内存回收特别少) （上面案例）</p>\n<p>硬件升级系统反而卡顿的问题<br>\n线程池不当运用产生OOM问题<br>\ntomcat http-header-size过大问题<br>\nlambda表达式导致方法区溢出问题(MethodArea / Perm Metaspace) LambdaGC.java -XX:MaxMetaspaceSize=9M -XX:+PrintGCDetails</p>\n<div class=\"language-bash ext-sh line-numbers-mode\"><pre v-pre class=\"language-bash\"><code><span class=\"token string\">\"C:<span class=\"token entity\" title=\"\\\\\">\\\\</span>Program Files<span class=\"token entity\" title=\"\\\\\">\\\\</span>Java<span class=\"token entity\" title=\"\\\\\">\\\\</span>jdk1.8.0_181<span class=\"token entity\" title=\"\\\\\">\\\\</span>bin<span class=\"token entity\" title=\"\\\\\">\\\\</span>java.exe\"</span> -XX:MaxMetaspaceSize<span class=\"token operator\">=</span>9M -XX:+PrintGCDetails <span class=\"token string\">\"-javaagent:C:<span class=\"token entity\" title=\"\\\\\">\\\\</span>Program Files<span class=\"token entity\" title=\"\\\\\">\\\\</span>JetBrains<span class=\"token entity\" title=\"\\\\\">\\\\</span>IntelliJ IDEA Community Edition 2019.1<span class=\"token entity\" title=\"\\\\\">\\\\</span>lib<span class=\"token entity\" title=\"\\\\\">\\\\</span>idea_rt.jar=49316:C:<span class=\"token entity\" title=\"\\\\\">\\\\</span>Program Files<span class=\"token entity\" title=\"\\\\\">\\\\</span>JetBrains<span class=\"token entity\" title=\"\\\\\">\\\\</span>IntelliJ IDEA Community Edition 2019.1<span class=\"token entity\" title=\"\\\\\">\\\\</span>bin\"</span> -Dfile.encoding<span class=\"token operator\">=</span>UTF-8 -classpath <span class=\"token string\">\"C:<span class=\"token entity\" title=\"\\\\\">\\\\</span>Program Files<span class=\"token entity\" title=\"\\\\\">\\\\</span>Java<span class=\"token entity\" title=\"\\\\\">\\\\</span>jdk1.8.0_181<span class=\"token entity\" title=\"\\\\\">\\\\</span>jre<span class=\"token entity\" title=\"\\\\\">\\\\</span>lib<span class=\"token entity\" title=\"\\\\\">\\\\</span>charsets.jar;C:<span class=\"token entity\" title=\"\\\\\">\\\\</span>Program Files<span class=\"token entity\" title=\"\\\\\">\\\\</span>Java<span class=\"token entity\" title=\"\\\\\">\\\\</span>jdk1.8.0_181<span class=\"token entity\" title=\"\\\\\">\\\\</span>jre<span class=\"token entity\" title=\"\\\\\">\\\\</span>lib<span class=\"token entity\" title=\"\\\\\">\\\\</span>deploy.jar;C:<span class=\"token entity\" title=\"\\\\\">\\\\</span>Program Files<span class=\"token entity\" title=\"\\\\\">\\\\</span>Java<span class=\"token entity\" title=\"\\\\\">\\\\</span>jdk1.8.0_181<span class=\"token entity\" title=\"\\\\\">\\\\</span>jre<span class=\"token entity\" title=\"\\\\\">\\\\</span>lib<span class=\"token entity\" title=\"\\\\\">\\\\</span>ext<span class=\"token entity\" title=\"\\\\\">\\\\</span>access-bridge-64.jar;C:<span class=\"token entity\" title=\"\\\\\">\\\\</span>Program Files<span class=\"token entity\" title=\"\\\\\">\\\\</span>Java<span class=\"token entity\" title=\"\\\\\">\\\\</span>jdk1.8.0_181<span class=\"token entity\" title=\"\\\\\">\\\\</span>jre<span class=\"token entity\" title=\"\\\\\">\\\\</span>lib<span class=\"token entity\" title=\"\\\\\">\\\\</span>ext<span class=\"token entity\" title=\"\\\\\">\\\\</span>cldrdata.jar;C:<span class=\"token entity\" title=\"\\\\\">\\\\</span>Program Files<span class=\"token entity\" title=\"\\\\\">\\\\</span>Java<span class=\"token entity\" title=\"\\\\\">\\\\</span>jdk1.8.0_181<span class=\"token entity\" title=\"\\\\\">\\\\</span>jre<span class=\"token entity\" title=\"\\\\\">\\\\</span>lib<span class=\"token entity\" title=\"\\\\\">\\\\</span>ext<span class=\"token entity\" title=\"\\\\\">\\\\</span>dnsns.jar;C:<span class=\"token entity\" title=\"\\\\\">\\\\</span>Program Files<span class=\"token entity\" title=\"\\\\\">\\\\</span>Java<span class=\"token entity\" title=\"\\\\\">\\\\</span>jdk1.8.0_181<span class=\"token entity\" title=\"\\\\\">\\\\</span>jre<span class=\"token entity\" title=\"\\\\\">\\\\</span>lib<span class=\"token entity\" title=\"\\\\\">\\\\</span>ext<span class=\"token entity\" title=\"\\\\\">\\\\</span>jaccess.jar;C:<span class=\"token entity\" title=\"\\\\\">\\\\</span>Program Files<span class=\"token entity\" title=\"\\\\\">\\\\</span>Java<span class=\"token entity\" title=\"\\\\\">\\\\</span>jdk1.8.0_181<span class=\"token entity\" title=\"\\\\\">\\\\</span>jre<span class=\"token entity\" title=\"\\\\\">\\\\</span>lib<span class=\"token entity\" title=\"\\\\\">\\\\</span>ext<span class=\"token entity\" title=\"\\\\\">\\\\</span>jfxrt.jar;C:<span class=\"token entity\" title=\"\\\\\">\\\\</span>Program Files<span class=\"token entity\" title=\"\\\\\">\\\\</span>Java<span class=\"token entity\" title=\"\\\\\">\\\\</span>jdk1.8.0_181<span class=\"token entity\" title=\"\\\\\">\\\\</span>jre<span class=\"token entity\" title=\"\\\\\">\\\\</span>lib<span class=\"token entity\" title=\"\\\\\">\\\\</span>ext<span class=\"token entity\" title=\"\\\\\">\\\\</span>localedata.jar;C:<span class=\"token entity\" title=\"\\\\\">\\\\</span>Program Files<span class=\"token entity\" title=\"\\\\\">\\\\</span>Java<span class=\"token entity\" title=\"\\\\\">\\\\</span>jdk1.8.0_181<span class=\"token entity\" title=\"\\\\\">\\\\</span>jre<span class=\"token entity\" title=\"\\\\\">\\\\</span>lib<span class=\"token entity\" title=\"\\\\\">\\\\</span>ext<span class=\"token entity\" title=\"\\\\\">\\\\</span>nashorn.jar;C:<span class=\"token entity\" title=\"\\\\\">\\\\</span>Program Files<span class=\"token entity\" title=\"\\\\\">\\\\</span>Java<span class=\"token entity\" title=\"\\\\\">\\\\</span>jdk1.8.0_181<span class=\"token entity\" title=\"\\\\\">\\\\</span>jre<span class=\"token entity\" title=\"\\\\\">\\\\</span>lib<span class=\"token entity\" title=\"\\\\\">\\\\</span>ext<span class=\"token entity\" title=\"\\\\\">\\\\</span>sunec.jar;C:<span class=\"token entity\" title=\"\\\\\">\\\\</span>Program Files<span class=\"token entity\" title=\"\\\\\">\\\\</span>Java<span class=\"token entity\" title=\"\\\\\">\\\\</span>jdk1.8.0_181<span class=\"token entity\" title=\"\\\\\">\\\\</span>jre<span class=\"token entity\" title=\"\\\\\">\\\\</span>lib<span class=\"token entity\" title=\"\\\\\">\\\\</span>ext<span class=\"token entity\" title=\"\\\\\">\\\\</span>sunjce_provider.jar;C:<span class=\"token entity\" title=\"\\\\\">\\\\</span>Program Files<span class=\"token entity\" title=\"\\\\\">\\\\</span>Java<span class=\"token entity\" title=\"\\\\\">\\\\</span>jdk1.8.0_181<span class=\"token entity\" title=\"\\\\\">\\\\</span>jre<span class=\"token entity\" title=\"\\\\\">\\\\</span>lib<span class=\"token entity\" title=\"\\\\\">\\\\</span>ext<span class=\"token entity\" title=\"\\\\\">\\\\</span>sunmscapi.jar;C:<span class=\"token entity\" title=\"\\\\\">\\\\</span>Program Files<span class=\"token entity\" title=\"\\\\\">\\\\</span>Java<span class=\"token entity\" title=\"\\\\\">\\\\</span>jdk1.8.0_181<span class=\"token entity\" title=\"\\\\\">\\\\</span>jre<span class=\"token entity\" title=\"\\\\\">\\\\</span>lib<span class=\"token entity\" title=\"\\\\\">\\\\</span>ext<span class=\"token entity\" title=\"\\\\\">\\\\</span>sunpkcs11.jar;C:<span class=\"token entity\" title=\"\\\\\">\\\\</span>Program Files<span class=\"token entity\" title=\"\\\\\">\\\\</span>Java<span class=\"token entity\" title=\"\\\\\">\\\\</span>jdk1.8.0_181<span class=\"token entity\" title=\"\\\\\">\\\\</span>jre<span class=\"token entity\" title=\"\\\\\">\\\\</span>lib<span class=\"token entity\" title=\"\\\\\">\\\\</span>ext<span class=\"token entity\" title=\"\\\\\">\\\\</span>zipfs.jar;C:<span class=\"token entity\" title=\"\\\\\">\\\\</span>Program Files<span class=\"token entity\" title=\"\\\\\">\\\\</span>Java<span class=\"token entity\" title=\"\\\\\">\\\\</span>jdk1.8.0_181<span class=\"token entity\" title=\"\\\\\">\\\\</span>jre<span class=\"token entity\" title=\"\\\\\">\\\\</span>lib<span class=\"token entity\" title=\"\\\\\">\\\\</span>javaws.jar;C:<span class=\"token entity\" title=\"\\\\\">\\\\</span>Program Files<span class=\"token entity\" title=\"\\\\\">\\\\</span>Java<span class=\"token entity\" title=\"\\\\\">\\\\</span>jdk1.8.0_181<span class=\"token entity\" title=\"\\\\\">\\\\</span>jre<span class=\"token entity\" title=\"\\\\\">\\\\</span>lib<span class=\"token entity\" title=\"\\\\\">\\\\</span>jce.jar;C:<span class=\"token entity\" title=\"\\\\\">\\\\</span>Program Files<span class=\"token entity\" title=\"\\\\\">\\\\</span>Java<span class=\"token entity\" title=\"\\\\\">\\\\</span>jdk1.8.0_181<span class=\"token entity\" title=\"\\\\\">\\\\</span>jre<span class=\"token entity\" title=\"\\\\\">\\\\</span>lib<span class=\"token entity\" title=\"\\\\\">\\\\</span>jfr.jar;C:<span class=\"token entity\" title=\"\\\\\">\\\\</span>Program Files<span class=\"token entity\" title=\"\\\\\">\\\\</span>Java<span class=\"token entity\" title=\"\\\\\">\\\\</span>jdk1.8.0_181<span class=\"token entity\" title=\"\\\\\">\\\\</span>jre<span class=\"token entity\" title=\"\\\\\">\\\\</span>lib<span class=\"token entity\" title=\"\\\\\">\\\\</span>jfxswt.jar;C:<span class=\"token entity\" title=\"\\\\\">\\\\</span>Program Files<span class=\"token entity\" title=\"\\\\\">\\\\</span>Java<span class=\"token entity\" title=\"\\\\\">\\\\</span>jdk1.8.0_181<span class=\"token entity\" title=\"\\\\\">\\\\</span>jre<span class=\"token entity\" title=\"\\\\\">\\\\</span>lib<span class=\"token entity\" title=\"\\\\\">\\\\</span>jsse.jar;C:<span class=\"token entity\" title=\"\\\\\">\\\\</span>Program Files<span class=\"token entity\" title=\"\\\\\">\\\\</span>Java<span class=\"token entity\" title=\"\\\\\">\\\\</span>jdk1.8.0_181<span class=\"token entity\" title=\"\\\\\">\\\\</span>jre<span class=\"token entity\" title=\"\\\\\">\\\\</span>lib<span class=\"token entity\" title=\"\\\\\">\\\\</span>management-agent.jar;C:<span class=\"token entity\" title=\"\\\\\">\\\\</span>Program Files<span class=\"token entity\" title=\"\\\\\">\\\\</span>Java<span class=\"token entity\" title=\"\\\\\">\\\\</span>jdk1.8.0_181<span class=\"token entity\" title=\"\\\\\">\\\\</span>jre<span class=\"token entity\" title=\"\\\\\">\\\\</span>lib<span class=\"token entity\" title=\"\\\\\">\\\\</span>plugin.jar;C:<span class=\"token entity\" title=\"\\\\\">\\\\</span>Program Files<span class=\"token entity\" title=\"\\\\\">\\\\</span>Java<span class=\"token entity\" title=\"\\\\\">\\\\</span>jdk1.8.0_181<span class=\"token entity\" title=\"\\\\\">\\\\</span>jre<span class=\"token entity\" title=\"\\\\\">\\\\</span>lib<span class=\"token entity\" title=\"\\\\\">\\\\</span>resources.jar;C:<span class=\"token entity\" title=\"\\\\\">\\\\</span>Program Files<span class=\"token entity\" title=\"\\\\\">\\\\</span>Java<span class=\"token entity\" title=\"\\\\\">\\\\</span>jdk1.8.0_181<span class=\"token entity\" title=\"\\\\\">\\\\</span>jre<span class=\"token entity\" title=\"\\\\\">\\\\</span>lib<span class=\"token entity\" title=\"\\\\\">\\\\</span>rt.jar;C:<span class=\"token entity\" title=\"\\\\\">\\\\</span>work<span class=\"token entity\" title=\"\\\\\">\\\\</span>ijprojects<span class=\"token entity\" title=\"\\\\\">\\\\</span>JVM<span class=\"token entity\" title=\"\\\\\">\\\\</span>out<span class=\"token entity\" title=\"\\\\\">\\\\</span>production<span class=\"token entity\" title=\"\\\\\">\\\\</span>JVM;C:<span class=\"token entity\" title=\"\\\\\">\\\\</span>work<span class=\"token entity\" title=\"\\\\\">\\\\</span>ijprojects<span class=\"token entity\" title=\"\\\\\">\\\\</span>ObjectSize<span class=\"token entity\" title=\"\\\\\">\\\\</span>out<span class=\"token entity\" title=\"\\\\\">\\\\</span>artifacts<span class=\"token entity\" title=\"\\\\\">\\\\</span>ObjectSize_jar<span class=\"token entity\" title=\"\\\\\">\\\\</span>ObjectSize.jar\"</span> com.mashibing.jvm.gc.LambdaGC\n<span class=\"token punctuation\">[</span>GC <span class=\"token punctuation\">(</span>Metadata GC Threshold<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span>PSYoungGen: 11341K-<span class=\"token operator\">></span>1880K<span class=\"token punctuation\">(</span>38400K<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span> 11341K-<span class=\"token operator\">></span>1888K<span class=\"token punctuation\">(</span>125952K<span class=\"token punctuation\">)</span>, <span class=\"token number\">0.0022190</span> secs<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>Times: <span class=\"token assign-left variable\">user</span><span class=\"token operator\">=</span><span class=\"token number\">0.00</span> <span class=\"token assign-left variable\">sys</span><span class=\"token operator\">=</span><span class=\"token number\">0.00</span>, <span class=\"token assign-left variable\">real</span><span class=\"token operator\">=</span><span class=\"token number\">0.00</span> secs<span class=\"token punctuation\">]</span> \n<span class=\"token punctuation\">[</span>Full GC <span class=\"token punctuation\">(</span>Metadata GC Threshold<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span>PSYoungGen: 1880K-<span class=\"token operator\">></span>0K<span class=\"token punctuation\">(</span>38400K<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>ParOldGen: 8K-<span class=\"token operator\">></span>1777K<span class=\"token punctuation\">(</span>35328K<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span> 1888K-<span class=\"token operator\">></span>1777K<span class=\"token punctuation\">(</span>73728K<span class=\"token punctuation\">)</span>, <span class=\"token punctuation\">[</span>Metaspace: 8164K-<span class=\"token operator\">></span>8164K<span class=\"token punctuation\">(</span>1056768K<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>, <span class=\"token number\">0.0100681</span> secs<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>Times: <span class=\"token assign-left variable\">user</span><span class=\"token operator\">=</span><span class=\"token number\">0.02</span> <span class=\"token assign-left variable\">sys</span><span class=\"token operator\">=</span><span class=\"token number\">0.00</span>, <span class=\"token assign-left variable\">real</span><span class=\"token operator\">=</span><span class=\"token number\">0.01</span> secs<span class=\"token punctuation\">]</span> \n<span class=\"token punctuation\">[</span>GC <span class=\"token punctuation\">(</span>Last ditch collection<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span>PSYoungGen: 0K-<span class=\"token operator\">></span>0K<span class=\"token punctuation\">(</span>38400K<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span> 1777K-<span class=\"token operator\">></span>1777K<span class=\"token punctuation\">(</span>73728K<span class=\"token punctuation\">)</span>, <span class=\"token number\">0.0005698</span> secs<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>Times: <span class=\"token assign-left variable\">user</span><span class=\"token operator\">=</span><span class=\"token number\">0.00</span> <span class=\"token assign-left variable\">sys</span><span class=\"token operator\">=</span><span class=\"token number\">0.00</span>, <span class=\"token assign-left variable\">real</span><span class=\"token operator\">=</span><span class=\"token number\">0.00</span> secs<span class=\"token punctuation\">]</span> \n<span class=\"token punctuation\">[</span>Full GC <span class=\"token punctuation\">(</span>Last ditch collection<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span>PSYoungGen: 0K-<span class=\"token operator\">></span>0K<span class=\"token punctuation\">(</span>38400K<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>ParOldGen: 1777K-<span class=\"token operator\">></span>1629K<span class=\"token punctuation\">(</span>67584K<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span> 1777K-<span class=\"token operator\">></span>1629K<span class=\"token punctuation\">(</span>105984K<span class=\"token punctuation\">)</span>, <span class=\"token punctuation\">[</span>Metaspace: 8164K-<span class=\"token operator\">></span>8156K<span class=\"token punctuation\">(</span>1056768K<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>, <span class=\"token number\">0.0124299</span> secs<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>Times: <span class=\"token assign-left variable\">user</span><span class=\"token operator\">=</span><span class=\"token number\">0.06</span> <span class=\"token assign-left variable\">sys</span><span class=\"token operator\">=</span><span class=\"token number\">0.00</span>, <span class=\"token assign-left variable\">real</span><span class=\"token operator\">=</span><span class=\"token number\">0.01</span> secs<span class=\"token punctuation\">]</span> \njava.lang.reflect.InvocationTargetException\n    at sun.reflect.NativeMethodAccessorImpl.invoke0<span class=\"token punctuation\">(</span>Native Method<span class=\"token punctuation\">)</span>\n    at sun.reflect.NativeMethodAccessorImpl.invoke<span class=\"token punctuation\">(</span>NativeMethodAccessorImpl.java:62<span class=\"token punctuation\">)</span>\n    at sun.reflect.DelegatingMethodAccessorImpl.invoke<span class=\"token punctuation\">(</span>DelegatingMethodAccessorImpl.java:43<span class=\"token punctuation\">)</span>\n    at java.lang.reflect.Method.invoke<span class=\"token punctuation\">(</span>Method.java:498<span class=\"token punctuation\">)</span>\n    at sun.instrument.InstrumentationImpl.loadClassAndStartAgent<span class=\"token punctuation\">(</span>InstrumentationImpl.java:388<span class=\"token punctuation\">)</span>\n    at sun.instrument.InstrumentationImpl.loadClassAndCallAgentmain<span class=\"token punctuation\">(</span>InstrumentationImpl.java:411<span class=\"token punctuation\">)</span>\nCaused by: java.lang.OutOfMemoryError: Compressed class space\n    at sun.misc.Unsafe.defineClass<span class=\"token punctuation\">(</span>Native Method<span class=\"token punctuation\">)</span>\n    at sun.reflect.ClassDefiner.defineClass<span class=\"token punctuation\">(</span>ClassDefiner.java:63<span class=\"token punctuation\">)</span>\n    at sun.reflect.MethodAccessorGenerator1.run<span class=\"token punctuation\">(</span>MethodAccessorGenerator.java:399<span class=\"token punctuation\">)</span>\n    at sun.reflect.MethodAccessorGenerator1.run<span class=\"token punctuation\">(</span>MethodAccessorGenerator.java:394<span class=\"token punctuation\">)</span>\n    at java.security.AccessController.doPrivileged<span class=\"token punctuation\">(</span>Native Method<span class=\"token punctuation\">)</span>\n    at sun.reflect.MethodAccessorGenerator.generate<span class=\"token punctuation\">(</span>MethodAccessorGenerator.java:393<span class=\"token punctuation\">)</span>\n    at sun.reflect.MethodAccessorGenerator.generateSerializationConstructor<span class=\"token punctuation\">(</span>MethodAccessorGenerator.java:112<span class=\"token punctuation\">)</span>\n    at sun.reflect.ReflectionFactory.generateConstructor<span class=\"token punctuation\">(</span>ReflectionFactory.java:398<span class=\"token punctuation\">)</span>\n    at sun.reflect.ReflectionFactory.newConstructorForSerialization<span class=\"token punctuation\">(</span>ReflectionFactory.java:360<span class=\"token punctuation\">)</span>\n    at java.io.ObjectStreamClass.getSerializableConstructor<span class=\"token punctuation\">(</span>ObjectStreamClass.java:1574<span class=\"token punctuation\">)</span>\n    at java.io.ObjectStreamClass.access1500<span class=\"token punctuation\">(</span>ObjectStreamClass.java:79<span class=\"token punctuation\">)</span>\n    at java.io.ObjectStreamClass3.run<span class=\"token punctuation\">(</span>ObjectStreamClass.java:519<span class=\"token punctuation\">)</span>\n    at java.io.ObjectStreamClass<span class=\"token variable\">$3</span>.run<span class=\"token punctuation\">(</span>ObjectStreamClass.java:494<span class=\"token punctuation\">)</span>\n    at java.security.AccessController.doPrivileged<span class=\"token punctuation\">(</span>Native Method<span class=\"token punctuation\">)</span>\n    at java.io.ObjectStreamClass.<span class=\"token operator\">&lt;</span>init<span class=\"token operator\">></span><span class=\"token punctuation\">(</span>ObjectStreamClass.java:494<span class=\"token punctuation\">)</span>\n    at java.io.ObjectStreamClass.lookup<span class=\"token punctuation\">(</span>ObjectStreamClass.java:391<span class=\"token punctuation\">)</span>\n    at java.io.ObjectOutputStream.writeObject0<span class=\"token punctuation\">(</span>ObjectOutputStream.java:1134<span class=\"token punctuation\">)</span>\n    at java.io.ObjectOutputStream.defaultWriteFields<span class=\"token punctuation\">(</span>ObjectOutputStream.java:1548<span class=\"token punctuation\">)</span>\n    at java.io.ObjectOutputStream.writeSerialData<span class=\"token punctuation\">(</span>ObjectOutputStream.java:1509<span class=\"token punctuation\">)</span>\n    at java.io.ObjectOutputStream.writeOrdinaryObject<span class=\"token punctuation\">(</span>ObjectOutputStream.java:1432<span class=\"token punctuation\">)</span>\n    at java.io.ObjectOutputStream.writeObject0<span class=\"token punctuation\">(</span>ObjectOutputStream.java:1178<span class=\"token punctuation\">)</span>\n    at java.io.ObjectOutputStream.writeObject<span class=\"token punctuation\">(</span>ObjectOutputStream.java:348<span class=\"token punctuation\">)</span>\n    at javax.management.remote.rmi.RMIConnectorServer.encodeJRMPStub<span class=\"token punctuation\">(</span>RMIConnectorServer.java:727<span class=\"token punctuation\">)</span>\n    at javax.management.remote.rmi.RMIConnectorServer.encodeStub<span class=\"token punctuation\">(</span>RMIConnectorServer.java:719<span class=\"token punctuation\">)</span>\n    at javax.management.remote.rmi.RMIConnectorServer.encodeStubInAddress<span class=\"token punctuation\">(</span>RMIConnectorServer.java:690<span class=\"token punctuation\">)</span>\n    at javax.management.remote.rmi.RMIConnectorServer.start<span class=\"token punctuation\">(</span>RMIConnectorServer.java:439<span class=\"token punctuation\">)</span>\n    at sun.management.jmxremote.ConnectorBootstrap.startLocalConnectorServer<span class=\"token punctuation\">(</span>ConnectorBootstrap.java:550<span class=\"token punctuation\">)</span>\n    at sun.management.Agent.startLocalManagementAgent<span class=\"token punctuation\">(</span>Agent.java:137<span class=\"token punctuation\">)</span>\n</code></pre><div class=\"line-numbers\"><span class=\"line-number\">1</span><br><span class=\"line-number\">2</span><br><span class=\"line-number\">3</span><br><span class=\"line-number\">4</span><br><span class=\"line-number\">5</span><br><span class=\"line-number\">6</span><br><span class=\"line-number\">7</span><br><span class=\"line-number\">8</span><br><span class=\"line-number\">9</span><br><span class=\"line-number\">10</span><br><span class=\"line-number\">11</span><br><span class=\"line-number\">12</span><br><span class=\"line-number\">13</span><br><span class=\"line-number\">14</span><br><span class=\"line-number\">15</span><br><span class=\"line-number\">16</span><br><span class=\"line-number\">17</span><br><span class=\"line-number\">18</span><br><span class=\"line-number\">19</span><br><span class=\"line-number\">20</span><br><span class=\"line-number\">21</span><br><span class=\"line-number\">22</span><br><span class=\"line-number\">23</span><br><span class=\"line-number\">24</span><br><span class=\"line-number\">25</span><br><span class=\"line-number\">26</span><br><span class=\"line-number\">27</span><br><span class=\"line-number\">28</span><br><span class=\"line-number\">29</span><br><span class=\"line-number\">30</span><br><span class=\"line-number\">31</span><br><span class=\"line-number\">32</span><br><span class=\"line-number\">33</span><br><span class=\"line-number\">34</span><br><span class=\"line-number\">35</span><br><span class=\"line-number\">36</span><br><span class=\"line-number\">37</span><br><span class=\"line-number\">38</span><br><span class=\"line-number\">39</span><br><span class=\"line-number\">40</span><br><span class=\"line-number\">41</span><br></div></div><p>直接内存溢出问题（少见）<br>\n《深入理解Java虚拟机》P59，使用Unsafe分配直接内存，或者使用NIO的问题<br>\n栈溢出问题<br>\n-Xss设定太小<br>\n比较一下这两段程序的异同，分析哪一个是更优的写法：</p>\n<div class=\"language-java ext-java line-numbers-mode\"><pre v-pre class=\"language-java\"><code><span class=\"token class-name\">Object</span> o <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">&lt;</span><span class=\"token number\">100</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n   o <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token comment\">//业务处理</span>\n<span class=\"token punctuation\">}</span>\n</code></pre><div class=\"line-numbers\"><span class=\"line-number\">1</span><br><span class=\"line-number\">2</span><br><span class=\"line-number\">3</span><br><span class=\"line-number\">4</span><br><span class=\"line-number\">5</span><br></div></div><div class=\"language-java ext-java line-numbers-mode\"><pre v-pre class=\"language-java\"><code><span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">&lt;</span><span class=\"token number\">100</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n   <span class=\"token class-name\">Object</span> o <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre><div class=\"line-numbers\"><span class=\"line-number\">1</span><br><span class=\"line-number\">2</span><br><span class=\"line-number\">3</span><br></div></div><p>重写finalize引发频繁GC<br>\nC++程序员重写finalize引发频繁GC问题 为什么C++程序员会重写finalize？（new delete） finalize耗时比较长（200ms）<br>\n如果有一个系统，内存一直消耗不超过10%，但是观察GC日志，发现FGC总是频繁产生，会是什么引起的？<br>\nSystem.gc() (这个比较Low)<br>\nDistuptor有个可以设置链的长度，如果过大，然后对象大，消费完不主动释放，会溢出<br>\n用jvm都会溢出，mycat用崩过，1.6.5某个临时版本解析sql子查询算法有问题，9个exists的联合sql就导致生成几百万的对象<br>\nnew 大量线程，会产生 native thread OOM<br>\n应该用线程池， 解决方案：减少堆空间,预留更多内存产生native thread JVM内存占物理内存比例 50% – 80%<br>\n常见垃圾回收器组合参数设定：(1.8)<br>\n-XX:+UseSerialGC = Serial New (DefNew) + Serial Old<br>\n小型程序。默认情况下不会是这种选项，HotSpot会根据计算及配置和JDK版本自动选择收集器<br>\n-XX:+UseParNewGC = ParNew + SerialOld<br>\n这个组合已经很少用（在某些版本中已经废弃）<br>\nhttps://stackoverflow.com/questions/34962257/why-remove-support-for-parnewserialold-anddefnewcms-in-the-future<br>\n-XX:+UseConc(urrent)MarkSweepGC = ParNew + CMS + Serial Old<br>\n-XX:+UseParallelGC = Parallel Scavenge + Parallel Old (1.8默认) 【PS + SerialOld】<br>\n-XX:+UseParallelOldGC = Parallel Scavenge + Parallel Old<br>\n-XX:+UseG1GC = G1<br>\nLinux中没找到默认GC的查看方法，而windows中会打印UseParallelGC<br>\njava +XX:+PrintCommandLineFlags -version<br>\n通过GC的日志来分辨<br>\nLinux下1.8版本默认的垃圾回收器到底是什么？<br>\n1.8.0_181 默认（看不出来）Copy MarkCompact<br>\n1.8.0_222 默认 PS + PO</p>\n","export * from \"-!../../../../../node_modules/vue-loader/dist/templateLoader.js??ruleSet[1].rules[1]!../../../../../node_modules/@vuepress/bundler-webpack/lib/build/ssr/vuepressLoader.js!../../../../../node_modules/vue-loader/dist/index.js??ruleSet[0].use[1]!./java_jvm_tuning.html.vue?vue&type=template&id=2876c742\"","import { ssrRender } from \"./java_jvm_tuning.html.vue?vue&type=template&id=2876c742\"\nconst script = {}\nimport { ssrContextKey } from 'vue'\nscript.ssrRender = (...args) => {\n  const ssrContext = args[2].appContext.provides[ssrContextKey]\n  ssrContext._registeredComponents.add(\"D:\\\\yaomin\\\\WorkSpace\\\\yaomin_java2\\\\node_modules\\\\@vuepress\\\\bundler-webpack\\\\lib\\\\build\\\\ssr\\\\vuepressLoader.js!D:\\\\yaomin\\\\WorkSpace\\\\yaomin_java2\\\\node_modules\\\\vue-loader\\\\dist\\\\index.js??ruleSet[0].use[1]!D:\\\\yaomin\\\\WorkSpace\\\\yaomin_java2\\\\docs\\\\.vuepress\\\\.temp\\\\pages\\\\java\\\\java_jvm_tuning.html.vue\")\n  return ssrRender(...args)\n}\n\n\nexport default script"],"names":["$withBase"],"sourceRoot":""}