"use strict";(self.webpackChunkyaomin=self.webpackChunkyaomin||[]).push([[3487],{5324:(n,s,a)=>{a.r(s),a.d(s,{data:()=>e});const e={key:"v-169e6309",path:"/soft/flink_hadoop.html",title:"Flink && Hadoop",lang:"zh-CN",frontmatter:{},excerpt:"",headers:[{level:2,title:"常用命令",slug:"常用命令",children:[]},{level:2,title:"一、部署前准备",slug:"一、部署前准备",children:[]},{level:2,title:"1、创建存放tool的路径",slug:"_1、创建存放tool的路径",children:[]},{level:2,title:"2、上传文件并解压（flink在主节点上）",slug:"_2、上传文件并解压-flink在主节点上",children:[]},{level:2,title:"3、通过scp把jdk包和hadoop包分别传到从机并解压",slug:"_3、通过scp把jdk包和hadoop包分别传到从机并解压",children:[]},{level:2,title:"4、配置环境变量（集群）",slug:"_4、配置环境变量-集群",children:[]},{level:2,title:"5、修改相关配置文件",slug:"_5、修改相关配置文件",children:[{level:3,title:"1）vim flink-conf.yaml",slug:"_1-vim-flink-conf-yaml",children:[]},{level:3,title:"2）vim core-site.xml",slug:"_2-vim-core-site-xml",children:[]},{level:3,title:"3)  vim yarn-site.xml",slug:"_3-vim-yarn-site-xml",children:[]},{level:3,title:"4）vim yarn-env.sh  在最后加一行",slug:"_4-vim-yarn-env-sh-在最后加一行",children:[]},{level:3,title:"5)  vim mapred-site.xml",slug:"_5-vim-mapred-site-xml",children:[]},{level:3,title:"6)  vim workers",slug:"_6-vim-workers",children:[]},{level:3,title:"7）vim hdfs-site.xml",slug:"_7-vim-hdfs-site-xml",children:[]},{level:3,title:"8）vim  hadoop-env.sh",slug:"_8-vim-hadoop-env-sh",children:[]}]},{level:2,title:"6、集群初始化（主节点）",slug:"_6、集群初始化-主节点",children:[]},{level:2,title:"7、启停服务",slug:"_7、启停服务",children:[]},{level:2,title:"8、测试",slug:"_8、测试",children:[]}],filePathRelative:"soft/flink_hadoop.md",git:{contributors:[{name:"Amin.Yao",email:"Amin.Yao@gaiaworks.cn",commits:3}]}}},2052:(n,s,a)=>{a.r(s),a.d(s,{default:()=>R});var e=a(6252);const t=(0,e.uE)('<h1 id="flink-hadoop" tabindex="-1"><a class="header-anchor" href="#flink-hadoop" aria-hidden="true">#</a> Flink &amp;&amp; Hadoop</h1><h2 id="常用命令" tabindex="-1"><a class="header-anchor" href="#常用命令" aria-hidden="true">#</a> 常用命令</h2><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 用来初始化hadoop</span>\nhadoop namenode -format\n<span class="token comment"># 查看应用列表</span>\n<span class="token function">yarn</span> application --list\n<span class="token comment"># 创建应用 test</span>\nyarn-session.sh -jm <span class="token number">1024</span> -tm <span class="token number">2048</span> -s <span class="token number">10</span> -nm <span class="token builtin class-name">test</span> -d -st\n<span class="token comment"># 终止应用</span>\n<span class="token function">yarn</span> application --kill application_1704300123553_0001\n\njps 查看java应用\n\n<span class="token comment"># 启动所有应用</span>\nstart-all.sh\n<span class="token comment"># 关闭所有应用</span>\nstop-all.sh\n\n\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h2 id="一、部署前准备" tabindex="-1"><a class="header-anchor" href="#一、部署前准备" aria-hidden="true">#</a> 一、部署前准备</h2><p>1、机器准备 (3台集群标准)</p><p>机器IP 节点 CPU&amp;内存 系统盘 存储 xx.xx.xx.xx Master 8C16G 100GB 200GB xx.xx.xx.xx Worker 8C16G 100GB 200GB xx.xx.xx.xx Worker 8C16G 100GB 200GB 2、检查防火墙是否关闭 systemctl status firewalld 若关闭，则检查下一项，若开启，则需要执行如下命令 systemctl stop firewalld ###临时关闭防火墙， systemctl disable firewalld ###永久关闭防火墙 3、检查selinux状态是否是disabled sestatus 若关闭，则检查下一项，若开启，则需要执行如下命令 setenforce 0 ###立即生效 ，重启系统后则恢复原状态 修改 /etc/selinux/config文件中的SELINUX=disabled保存退出后，永久生效，</p><p>4、检查磁盘挂载（存储盘全部挂载） df-h ###查看磁盘空间</p><p>5、修改主机名（也可不修改） 1）临时修改 （重启失效） hostname 主机名 2）永久修改主机名（重启不失效） hostnamectl set-hostname 主机名 或者 vim /etc/hostname 删除旧主机名，添加新的 6、免密登录 （以下路径是示例，根据实际选择路径） ssh-keygen -t rsa 一路回车</p><pre><code>       cd /home/devops/.ssh/\n       cat id_rsa.pub &gt;&gt;authorized_keys\n       chmod  700 .ssh\n       chmod 600 authorized_keys\n   注：集群的id_rsa.pub要写入authorized_keys中，所涉及的机器都要写入\n</code></pre><p>7、host解析（root用户下，集群机器） vim /etc/hosts xx.xx.xx.xx 主机名1 xx.xx.xx.xx 主机名2 xx.xx.xx.xx 主机名3 8、创建路径并授权（root用户下，名字自定义，作为挂载路径） mkdir /data chmod 777 /data</p><h1 id="二、详细步骤" tabindex="-1"><a class="header-anchor" href="#二、详细步骤" aria-hidden="true">#</a> 二、详细步骤</h1><h2 id="_1、创建存放tool的路径" tabindex="-1"><a class="header-anchor" href="#_1、创建存放tool的路径" aria-hidden="true">#</a> 1、创建存放tool的路径</h2><p>主机：mkdir /opt/{flink,java,hadoop} 从机：mkdir /opt/{java,hadoop}</p><h2 id="_2、上传文件并解压-flink在主节点上" tabindex="-1"><a class="header-anchor" href="#_2、上传文件并解压-flink在主节点上" aria-hidden="true">#</a> 2、上传文件并解压（flink在主节点上）</h2><p>从Flink官方网站下载最新版本的Flink二进制发行版。解压缩下载的文件到计算机上的目标文件夹，例如/opt/flink 在计算机上安装Java运行时环境（JRE）或Java开发工具包（JDK）。Flink需要Java 8或更高版本才能正常运行。例如/opt/java 安装hadoop集成，例如/opt/hadoop</p><h2 id="_3、通过scp把jdk包和hadoop包分别传到从机并解压" tabindex="-1"><a class="header-anchor" href="#_3、通过scp把jdk包和hadoop包分别传到从机并解压" aria-hidden="true">#</a> 3、通过scp把jdk包和hadoop包分别传到从机并解压</h2><p>scp -P 端口 jdk-8u341-linux-x64.tar.gz 用户@主机名:/opt/java/ scp -P 端口 hadoop压缩包 用户@主机名:/opt/hadoop/</p><h2 id="_4、配置环境变量-集群" tabindex="-1"><a class="header-anchor" href="#_4、配置环境变量-集群" aria-hidden="true">#</a> 4、配置环境变量（集群）</h2><p>在/etc/profile文件最后添加 （代码块中的路径均为例子，按照自己配置的为准） export JAVA_HOME=/opt/java/jdk1.8.0_192 export CLASSPATH=.😒{JAVA_HOME}/jre/lib/rt.jar:${JAVA_HOME}/lib/dt.jar:${JAVA_HOME}/lib/tools.jar export PATH=$PATH:$JAVA_HOME/bin</p><p>HADOOP_HOME=/opt/hadoop/hadoop-3.3.1 export PATH=$PATH:$HADOOP_HOME/bin:$HADOOP_HOME/sbin export HADOOP_PID_DIR=${HADOOP_HOME}/pids</p><p>FLINK_HOME=/opt/flink/flink-1.12.7 export PATH=$PATH:$FLINK_HOME/bin</p><p>export HADOOP_CONF_DIR=/opt/hadoop/hadoop-3.3.1/etc/hadoop</p><p>export JAVA_LIBRARY_PATH=$HADOOP_HOME/lib/native</p><p>export FORMAT_MESSAGES_PATTERN_DISABLE_LOOKUPS=true source /etc/profile使其生效</p><h2 id="_5、修改相关配置文件" tabindex="-1"><a class="header-anchor" href="#_5、修改相关配置文件" aria-hidden="true">#</a> 5、修改相关配置文件</h2><h3 id="_1-vim-flink-conf-yaml" tabindex="-1"><a class="header-anchor" href="#_1-vim-flink-conf-yaml" aria-hidden="true">#</a> 1）vim flink-conf.yaml</h3><div class="language-properties ext-properties line-numbers-mode"><pre class="language-properties"><code>\n<span class="token comment"># The external address of the host on which the JobManager runs and can be</span>\n<span class="token comment"># reached by the TaskManagers and any clients which want to connect. This setting</span>\n<span class="token comment"># is only used in Standalone mode and may be overwritten on the JobManager side</span>\n<span class="token comment"># by specifying the --host &lt;hostname&gt; parameter of the bin/jobmanager.sh executable.</span>\n<span class="token comment"># In high availability mode, if you use the bin/start-cluster.sh script and setup</span>\n<span class="token comment"># the conf/masters file, this will be taken care of automatically. Yarn/Mesos</span>\n<span class="token comment"># automatically configure the host name based on the hostname of the node where the</span>\n<span class="token comment"># JobManager runs.</span>\n\n<span class="token attr-name">jobmanager.rpc.address</span><span class="token punctuation">:</span> <span class="token attr-value">localhost</span>\n\n<span class="token comment"># The RPC port where the JobManager is reachable.</span>\n\n<span class="token attr-name">jobmanager.rpc.port</span><span class="token punctuation">:</span> <span class="token attr-value">6123</span>\n\n\n<span class="token comment"># The total process memory size for the JobManager.</span>\n<span class="token comment">#</span>\n<span class="token comment"># Note this accounts for all memory usage within the JobManager process, including JVM metaspace and other overhead.</span>\n\n<span class="token attr-name">jobmanager.memory.process.size</span><span class="token punctuation">:</span> <span class="token attr-value">2048m</span>\n\n\n<span class="token comment"># The total process memory size for the TaskManager.</span>\n<span class="token comment">#</span>\n<span class="token comment"># Note this accounts for all memory usage within the TaskManager process, including JVM metaspace and other overhead.</span>\n\n<span class="token attr-name">taskmanager.memory.process.size</span><span class="token punctuation">:</span> <span class="token attr-value">4096m</span>\n\n<span class="token comment"># To exclude JVM metaspace and overhead, please, use total Flink memory size instead of &#39;taskmanager.memory.process.size&#39;.</span>\n<span class="token comment"># It is not recommended to set both &#39;taskmanager.memory.process.size&#39; and Flink memory.</span>\n<span class="token comment">#</span>\n<span class="token comment"># taskmanager.memory.flink.size: 1280m</span>\n\n<span class="token comment"># The number of task slots that each TaskManager offers. Each slot runs one parallel pipeline.</span>\n\n<span class="token attr-name">taskmanager.numberOfTaskSlots</span><span class="token punctuation">:</span> <span class="token attr-value">30</span>\n\n<span class="token comment"># The parallelism used for programs that did not specify and other parallelism.</span>\n\n<span class="token attr-name">parallelism.default</span><span class="token punctuation">:</span> <span class="token attr-value">10</span>\n<span class="token attr-name">yarn.containers.vcores</span><span class="token punctuation">:</span> <span class="token attr-value">4</span>\n<span class="token attr-name">yarn.application-attempts</span><span class="token punctuation">:</span> <span class="token attr-value">10</span>\n\n<span class="token comment"># zookeeper HA</span>\n<span class="token attr-name">high-availability</span><span class="token punctuation">:</span> <span class="token attr-value">zookeeper</span>\n<span class="token attr-name">high-availability.zookeeper.quorum</span><span class="token punctuation">:</span> <span class="token attr-value">IP:PORT,IP:PORT,IP:PORT</span>\n<span class="token attr-name">high-availability.storageDir</span><span class="token punctuation">:</span> <span class="token attr-value">hdfs://主机名:9000/flink-1.12.7/flink/recovery</span>\n<span class="token attr-name">high-availability.zookeeper.path.root</span><span class="token punctuation">:</span> <span class="token attr-value">/flink-1.12.7</span>\n\n<span class="token comment">#promgateway</span>\n<span class="token comment">#metrics.reporter.promgateway.class: org.apache.flink.metrics.prometheus.PrometheusPushGatewayReporter</span>\n<span class="token comment">#metrics.reporter.promgateway.host: 192.168.3.43</span>\n<span class="token comment">#metrics.reporter.promgateway.port: 9091</span>\n<span class="token comment">#metrics.reporter.promgateway.jobName: DCP-flink-1.9.1</span>\n<span class="token comment">#metrics.reporter.promgateway.randomJobNameSuffix: true</span>\n<span class="token comment">#metrics.reporter.promgateway.deleteOnShutdown: true</span>\n\n\n<span class="token comment">#metrics.reporter.grph.class: org.apache.flink.metrics.graphite.GraphiteReporter</span>\n<span class="token comment">#metrics.reporter.grph.host: 47.101.44.28</span>\n<span class="token comment">#metrics.reporter.grph.port: 2003</span>\n<span class="token comment">#metrics.reporter.grph.protocol: TCP</span>\n<span class="token comment">#metrics</span>\n<span class="token attr-name">metrics.scope.jm</span><span class="token punctuation">:</span> <span class="token attr-value">&lt;host&gt;.jobmanager</span>\n<span class="token attr-name">metrics.scope.jm.job</span><span class="token punctuation">:</span> <span class="token attr-value">&lt;host&gt;.jobmanager.&lt;job_name&gt;</span>\n<span class="token attr-name">metrics.scope.tm</span><span class="token punctuation">:</span> <span class="token attr-value">&lt;host&gt;.taskmanager.&lt;tm_id&gt;</span>\n<span class="token attr-name">metrics.scope.tm.job</span><span class="token punctuation">:</span> <span class="token attr-value">&lt;host&gt;.taskmanager.&lt;tm_id&gt;.&lt;job_name&gt;</span>\n<span class="token attr-name">metrics.scope.task</span><span class="token punctuation">:</span> <span class="token attr-value">&lt;host&gt;.taskmanager.&lt;tm_id&gt;.&lt;job_name&gt;.&lt;task_name&gt;.&lt;subtask_index&gt;</span>\n<span class="token attr-name">metrics.scope.operator</span><span class="token punctuation">:</span> <span class="token attr-value">&lt;host&gt;.taskmanager.&lt;tm_id&gt;.&lt;job_name&gt;.&lt;operator_name&gt;.&lt;subtask_index&gt;</span>\n\n\n<span class="token comment"># The default file system scheme and authority.</span>\n<span class="token comment"># </span>\n<span class="token comment"># By default file paths without scheme are interpreted relative to the local</span>\n<span class="token comment"># root file system &#39;file:///&#39;. Use this to override the default and interpret</span>\n<span class="token comment"># relative paths relative to a different file system,</span>\n<span class="token comment"># for example &#39;hdfs://mynamenode:12345&#39;</span>\n<span class="token comment">#</span>\n<span class="token comment"># fs.default-scheme</span>\n\n<span class="token comment">#==============================================================================</span>\n<span class="token comment"># High Availability</span>\n<span class="token comment">#==============================================================================</span>\n\n<span class="token comment"># The high-availability mode. Possible options are &#39;NONE&#39; or &#39;zookeeper&#39;.</span>\n<span class="token comment">#</span>\n<span class="token comment"># high-availability: zookeeper</span>\n\n<span class="token comment"># The path where metadata for master recovery is persisted. While ZooKeeper stores</span>\n<span class="token comment"># the small ground truth for checkpoint and leader election, this location stores</span>\n<span class="token comment"># the larger objects, like persisted dataflow graphs.</span>\n<span class="token comment"># </span>\n<span class="token comment"># Must be a durable file system that is accessible from all nodes</span>\n<span class="token comment"># (like HDFS, S3, Ceph, nfs, ...)</span>\n<span class="token comment">#</span>\n<span class="token comment"># high-availability.storageDir: hdfs:///flink/ha/</span>\n\n<span class="token comment"># The list of ZooKeeper quorum peers that coordinate the high-availability</span>\n<span class="token comment"># setup. This must be a list of the form:</span>\n<span class="token comment"># &quot;host1:clientPort,host2:clientPort,...&quot; (default clientPort: 2181)</span>\n<span class="token comment">#</span>\n<span class="token comment"># high-availability.zookeeper.quorum: localhost:2181</span>\n\n\n<span class="token comment"># ACL options are based on https://zookeeper.apache.org/doc/r3.1.2/zookeeperProgrammers.html#sc_BuiltinACLSchemes</span>\n<span class="token comment"># It can be either &quot;creator&quot; (ZOO_CREATE_ALL_ACL) or &quot;open&quot; (ZOO_OPEN_ACL_UNSAFE)</span>\n<span class="token comment"># The default value is &quot;open&quot; and it can be changed to &quot;creator&quot; if ZK security is enabled</span>\n<span class="token comment">#</span>\n<span class="token comment"># high-availability.zookeeper.client.acl: open</span>\n\n<span class="token comment">#==============================================================================</span>\n<span class="token comment"># Fault tolerance and checkpointing</span>\n<span class="token comment">#==============================================================================</span>\n\n<span class="token comment"># The backend that will be used to store operator state checkpoints if</span>\n<span class="token comment"># checkpointing is enabled.</span>\n<span class="token comment">#</span>\n<span class="token comment"># Supported backends are &#39;jobmanager&#39;, &#39;filesystem&#39;, &#39;rocksdb&#39;, or the</span>\n<span class="token comment"># &lt;class-name-of-factory&gt;.</span>\n<span class="token comment">#</span>\n<span class="token attr-name">state.backend</span><span class="token punctuation">:</span> <span class="token attr-value">filesystem</span>\n\n<span class="token comment"># Directory for checkpoints filesystem, when using any of the default bundled</span>\n<span class="token comment"># state backends.</span>\n<span class="token comment">#</span>\n<span class="token attr-name">state.checkpoints.dir</span><span class="token punctuation">:</span> <span class="token attr-value">hdfs://主机名:9000/flink-1.12.7/flink-checkpoints</span>\n\n<span class="token comment"># Default target directory for savepoints, optional.</span>\n<span class="token comment">#</span>\n<span class="token attr-name">state.savepoints.dir</span><span class="token punctuation">:</span> <span class="token attr-value">hdfs://主机名:9000/flink-1.12.7/flink-savepoints</span>\n\n<span class="token comment"># Flag to enable/disable incremental checkpoints for backends that</span>\n<span class="token comment"># support incremental checkpoints (like the RocksDB state backend).</span>\n<span class="token comment">#</span>\n<span class="token attr-name">state.backend.incremental</span><span class="token punctuation">:</span> <span class="token attr-value">false</span>\n\n<span class="token comment"># The failover strategy, i.e., how the job computation recovers from task failures.</span>\n<span class="token comment"># Only restart tasks that may have been affected by the task failure, which typically includes</span>\n<span class="token comment"># downstream tasks and potentially upstream tasks if their produced data is no longer available for consumption.</span>\n\n<span class="token attr-name">jobmanager.execution.failover-strategy</span><span class="token punctuation">:</span> <span class="token attr-value">region</span>\n\n<span class="token comment">#==============================================================================</span>\n<span class="token comment"># Rest &amp; web frontend</span>\n<span class="token comment">#==============================================================================</span>\n\n<span class="token comment"># The port to which the REST client connects to. If rest.bind-port has</span>\n<span class="token comment"># not been specified, then the server will bind to this port as well.</span>\n<span class="token comment">#</span>\n<span class="token attr-name">rest.port</span><span class="token punctuation">:</span> <span class="token attr-value">8081</span>\n\n<span class="token comment"># The address to which the REST client will connect to</span>\n<span class="token comment">#</span>\n<span class="token comment">#rest.address: 0.0.0.0</span>\n\n<span class="token comment"># Port range for the REST and web server to bind to.</span>\n<span class="token comment">#</span>\n<span class="token attr-name">rest.bind-port</span><span class="token punctuation">:</span> <span class="token attr-value">8085-8087</span>\n\n<span class="token comment"># The address that the REST &amp; web server binds to</span>\n<span class="token comment">#</span>\n<span class="token comment">#rest.bind-address: 0.0.0.0</span>\n\n<span class="token comment"># Flag to specify whether job submission is enabled from the web-based</span>\n<span class="token comment"># runtime monitor. Uncomment to disable.</span>\n\n<span class="token comment">#web.submit.enable: false</span>\n<span class="token attr-name">web.tmpdir</span><span class="token punctuation">:</span> <span class="token attr-value">/opt/flink-1.12/flink-web</span>\n<span class="token attr-name">web.upload.dir</span><span class="token punctuation">:</span> <span class="token attr-value">/opt/flink-1.12/jars</span>\n\n<span class="token comment">#==============================================================================</span>\n<span class="token comment"># Advanced</span>\n<span class="token comment">#==============================================================================</span>\n\n<span class="token comment"># Override the directories for temporary files. If not specified, the</span>\n<span class="token comment"># system-specific Java temporary directory (java.io.tmpdir property) is taken.</span>\n<span class="token comment">#</span>\n<span class="token comment"># For framework setups on Yarn or Mesos, Flink will automatically pick up the</span>\n<span class="token comment"># containers&#39; temp directories without any need for configuration.</span>\n<span class="token comment">#</span>\n<span class="token comment"># Add a delimited list for multiple directories, using the system directory</span>\n<span class="token comment"># delimiter (colon &#39;:&#39; on unix) or a comma, e.g.:</span>\n<span class="token comment">#     /data1/tmp:/data/tmp:/data3/tmp</span>\n<span class="token comment">#</span>\n<span class="token comment"># Note: Each directory entry is read from and written to by a different I/O</span>\n<span class="token comment"># thread. You can include the same directory multiple times in order to create</span>\n<span class="token comment"># multiple I/O threads against that directory. This is for example relevant for</span>\n<span class="token comment"># high-throughput RAIDs.</span>\n<span class="token comment">#</span>\n<span class="token comment"># io.tmp.dirs: /tmp</span>\n\n<span class="token comment"># The classloading resolve order. Possible values are &#39;child-first&#39; (Flink&#39;s default)</span>\n<span class="token comment"># and &#39;parent-first&#39; (Java&#39;s default).</span>\n<span class="token comment">#</span>\n<span class="token comment"># Child first classloading allows users to use different dependency/library</span>\n<span class="token comment"># versions in their application than those in the classpath. Switching back</span>\n<span class="token comment"># to &#39;parent-first&#39; may help with debugging dependency issues.</span>\n<span class="token comment">#</span>\n<span class="token comment"># classloader.resolve-order: child-first</span>\n\n<span class="token comment"># The amount of memory going to the network stack. These numbers usually need</span>\n<span class="token comment"># no tuning. Adjusting them may be necessary in case of an &quot;Insufficient number</span>\n<span class="token comment"># of network buffers&quot; error. The default min is 64MB, the default max is 1GB.</span>\n<span class="token comment"># </span>\n<span class="token comment"># taskmanager.memory.network.fraction: 0.1</span>\n<span class="token comment"># taskmanager.memory.network.min: 64mb</span>\n<span class="token comment"># taskmanager.memory.network.max: 1gb</span>\n\n<span class="token comment"># flink自己管理内存，系数，默认0.4</span>\n<span class="token attr-name">taskmanager.memory.managed.fraction</span><span class="token punctuation">:</span> <span class="token attr-value">0.1</span>\n<span class="token comment"># flink网络缓冲区，最大值，1GB</span>\n<span class="token attr-name">taskmanager.memory.network.max</span><span class="token punctuation">:</span> <span class="token attr-value">200mb</span>\n<span class="token comment"># flink jvm元数据大小，默认96</span>\n<span class="token attr-name">taskmanager.memory.jvm-metaspace.size</span><span class="token punctuation">:</span> <span class="token attr-value">256mb</span>\n\n<span class="token comment">#==============================================================================</span>\n<span class="token comment"># Flink Cluster Security Configuration</span>\n<span class="token comment">#==============================================================================</span>\n\n<span class="token comment"># Kerberos authentication for various components - Hadoop, ZooKeeper, and connectors -</span>\n<span class="token comment"># may be enabled in four steps:</span>\n<span class="token comment"># 1. configure the local krb5.conf file</span>\n<span class="token comment"># 2. provide Kerberos credentials (either a keytab or a ticket cache w/ kinit)</span>\n<span class="token comment"># 3. make the credentials available to various JAAS login contexts</span>\n<span class="token comment"># 4. configure the connector to use JAAS/SASL</span>\n\n<span class="token comment"># The below configure how Kerberos credentials are provided. A keytab will be used instead of</span>\n<span class="token comment"># a ticket cache if the keytab path and principal are set.</span>\n\n<span class="token comment"># security.kerberos.login.use-ticket-cache: true</span>\n<span class="token comment"># security.kerberos.login.keytab: /path/to/kerberos/keytab</span>\n<span class="token comment"># security.kerberos.login.principal: flink-user</span>\n\n<span class="token comment"># The configuration below defines which JAAS login contexts</span>\n\n<span class="token comment"># security.kerberos.login.contexts: Client,KafkaClient</span>\n\n<span class="token comment">#==============================================================================</span>\n<span class="token comment"># ZK Security Configuration</span>\n<span class="token comment">#==============================================================================</span>\n\n<span class="token comment"># Below configurations are applicable if ZK ensemble is configured for security</span>\n\n<span class="token comment"># Override below configuration to provide custom ZK service name if configured</span>\n<span class="token comment"># zookeeper.sasl.service-name: zookeeper</span>\n\n<span class="token comment"># The configuration below must match one of the values set in &quot;security.kerberos.login.contexts&quot;</span>\n<span class="token comment"># zookeeper.sasl.login-context-name: Client</span>\n\n<span class="token comment">#==============================================================================</span>\n<span class="token comment"># HistoryServer</span>\n<span class="token comment">#==============================================================================</span>\n\n<span class="token comment"># The HistoryServer is started and stopped via bin/historyserver.sh (start|stop)</span>\n\n<span class="token comment"># Directory to upload completed jobs to. Add this directory to the list of</span>\n<span class="token comment"># monitored directories of the HistoryServer as well (see below).</span>\n<span class="token attr-name">jobmanager.archive.fs.dir</span><span class="token punctuation">:</span> <span class="token attr-value">hdfs://flinkp1:9000/flink-1.12.7/completed-jobs</span>\n\n<span class="token comment"># The address under which the web-based HistoryServer listens.</span>\n<span class="token comment">#historyserver.web.address: 0.0.0.0</span>\n\n<span class="token comment"># The port under which the web-based HistoryServer listens.</span>\n<span class="token comment">#historyserver.web.port: 8082</span>\n\n<span class="token comment"># Comma separated list of directories to monitor for completed jobs.</span>\n<span class="token attr-name">historyserver.archive.fs.dir</span><span class="token punctuation">:</span> <span class="token attr-value">hdfs://flinkp1:9000/flink-1.12.7/completed-jobs</span>\n\n<span class="token comment"># Interval in milliseconds for refreshing the monitored directories.</span>\n<span class="token attr-name">historyserver.archive.fs.refresh-interval</span><span class="token punctuation">:</span> <span class="token attr-value">10000</span>\n\n<span class="token attr-name">restart-strategy.failure-rate.max-failures-per-interval</span><span class="token punctuation">:</span> <span class="token attr-value">3</span>\n<span class="token attr-name">restart-strategy.failure-rate.failure-rate-interval</span><span class="token punctuation">:</span> <span class="token attr-value">5 min</span>\n<span class="token attr-name">restart-strategy.failure-rate.delay</span><span class="token punctuation">:</span> <span class="token attr-value">10 s</span>\n\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br><span class="line-number">232</span><br><span class="line-number">233</span><br><span class="line-number">234</span><br><span class="line-number">235</span><br><span class="line-number">236</span><br><span class="line-number">237</span><br><span class="line-number">238</span><br><span class="line-number">239</span><br><span class="line-number">240</span><br><span class="line-number">241</span><br><span class="line-number">242</span><br><span class="line-number">243</span><br><span class="line-number">244</span><br><span class="line-number">245</span><br><span class="line-number">246</span><br><span class="line-number">247</span><br><span class="line-number">248</span><br><span class="line-number">249</span><br><span class="line-number">250</span><br><span class="line-number">251</span><br><span class="line-number">252</span><br><span class="line-number">253</span><br><span class="line-number">254</span><br><span class="line-number">255</span><br><span class="line-number">256</span><br><span class="line-number">257</span><br><span class="line-number">258</span><br><span class="line-number">259</span><br><span class="line-number">260</span><br><span class="line-number">261</span><br><span class="line-number">262</span><br><span class="line-number">263</span><br><span class="line-number">264</span><br><span class="line-number">265</span><br><span class="line-number">266</span><br><span class="line-number">267</span><br><span class="line-number">268</span><br><span class="line-number">269</span><br><span class="line-number">270</span><br><span class="line-number">271</span><br><span class="line-number">272</span><br><span class="line-number">273</span><br><span class="line-number">274</span><br><span class="line-number">275</span><br><span class="line-number">276</span><br><span class="line-number">277</span><br></div></div><h3 id="_2-vim-core-site-xml" tabindex="-1"><a class="header-anchor" href="#_2-vim-core-site-xml" aria-hidden="true">#</a> 2）vim core-site.xml</h3>',28),p=(0,e.Uk)("fs.defaultFS"),r=(0,e.Uk)("hdfs://主机名1:9000"),l=(0,e.Uk)("hadoop.tmp.dir"),o=(0,e.Uk)("file:/data/hadoop/tmp"),c=(0,e.Uk)("Abase for other temporary directories."),m=(0,e._)("h3",{id:"_3-vim-yarn-site-xml",tabindex:"-1"},[(0,e._)("a",{class:"header-anchor",href:"#_3-vim-yarn-site-xml","aria-hidden":"true"},"#"),(0,e.Uk)(" 3) vim yarn-site.xml")],-1),i=(0,e.Uk)("yarn.nodemanager.aux-services"),b=(0,e.Uk)("mapreduce_shuffle"),u=(0,e._)("pre",null,[(0,e._)("code",null,"<property>\n    \x3c!-- 配置ResourceManager的服务节点 --\x3e\n    <name>yarn.resourcemanager.hostname</name>\n    <value>主机名1</value>\n</property>\n\n<property>\n    <name>yarn.resourcemanager.address</name>\n    <value>主机名1:8032</value>\n</property>\n\n<property>\n    <name>yarn.resourcemanager.webapp.address</name>\n    <value>主机名1:8088</value>\n</property>\n\n    \x3c!-- 配置当前节点yarn的可用资源 start --\x3e\n<property>\n    <name>yarn.nodemanager.resource.cpu-vcores</name>\n       <value>15</value>\n</property>\n\n    <property>\n    <name>yarn.nodemanager.resource.memory-mb</name>\n       <value>30000</value>\n</property>\n    \x3c!-- 配置当前节点yarn的可用资源 end --\x3e\n\n\n    \x3c!-- 任务资源分配规则 start --\x3e\n<property>\n    <name>yarn.scheduler.minimum-allocation-vcores</name>\n       <value>1</value>\n</property>\n\n<property>\n    <name>yarn.scheduler.maximum-allocation-vcores</name>\n       <value>4</value>\n</property>\n    \x3c!-- 任务资源分配规则 end --\x3e\n\n\n    <property>\n    <name>yarn.log-aggregation-enable</name>\n       <value>true</value>\n</property>\n\n<property>\n      <name>yarn.nodemanager.vmem-check-enabled</name>\n      <value>false</value>\n      <description>Whether virtual memory limits will be enforced for containers.</description>\n</property>\n\n    <property>\n      <name>yarn.resourcemanager.am.max-attempts</name>\n      <value>10</value>\n      <description>\n            The maximum number of application master execution attempts.\n      </description>\n    </property>\n\n    \x3c!-- 配置RM重启保存yarn上job状态 start --\x3e\n     <property>\n       <description>Enable RM to recover state after starting. If true, then\n       yarn.resourcemanager.store.class must be specified</description>\n       <name>yarn.resourcemanager.recovery.enabled</name>\n       <value>true</value>\n     </property>\n\n     <property>\n       <description>The class to use as the persistent store.</description>\n       <name>yarn.resourcemanager.store.class</name>\n       <value>org.apache.hadoop.yarn.server.resourcemanager.recovery.FileSystemRMStateStore</value>\n     </property>\n\n     <property>\n       <name>yarn.resourcemanager.fs.state-store.uri</name>\n       <value>${hadoop.tmp.dir}/yarn/system/rmstore</value>\n     </property>\n    \x3c!-- 配置RM重启保存yarn上job状态 end --\x3e\n")],-1),d=(0,e._)("h3",{id:"_4-vim-yarn-env-sh-在最后加一行",tabindex:"-1"},[(0,e._)("a",{class:"header-anchor",href:"#_4-vim-yarn-env-sh-在最后加一行","aria-hidden":"true"},"#"),(0,e.Uk)(" 4）vim yarn-env.sh 在最后加一行")],-1),h=(0,e._)("p",null,"export JAVA_HOME=/opt/jdk1.8.0_192",-1),k=(0,e._)("h3",{id:"_5-vim-mapred-site-xml",tabindex:"-1"},[(0,e._)("a",{class:"header-anchor",href:"#_5-vim-mapred-site-xml","aria-hidden":"true"},"#"),(0,e.Uk)(" 5) vim mapred-site.xml")],-1),f=(0,e.Uk)("mapreduce.framework.name"),v=(0,e.Uk)("yarn"),y=(0,e.Uk)("mapreduce.application.classpath"),g=(0,e.Uk)(" /home/devops/hadoop/hadoop-3.3.1/etc/hadoop, /home/devops/hadoop/hadoop-3.3.1/share/hadoop/common/*, /home/devops/hadoop/hadoop-3.3.1/share/hadoop/common/lib/*, /home/devops/hadoop/hadoop-3.3.1/share/hadoop/hdfs/*, /home/devops/hadoop/hadoop-3.3.1/share/hadoop/hdfs/lib/*, /home/devops/hadoop/hadoop-3.3.1/share/hadoop/mapreduce/*, /home/devops/hadoop/hadoop-3.3.1/share/hadoop/mapreduce/lib/*, /home/devops/hadoop/hadoop-3.3.1/share/hadoop/yarn/*, /home/devops/hadoop/hadoop-3.3.1/share/hadoop/yarn/lib/* "),_=(0,e._)("h3",{id:"_6-vim-workers",tabindex:"-1"},[(0,e._)("a",{class:"header-anchor",href:"#_6-vim-workers","aria-hidden":"true"},"#"),(0,e.Uk)(" 6) vim workers")],-1),x=(0,e._)("pre",null,[(0,e._)("code",null,"                主机名1\n                主机名2\n                主机名3\n")],-1),w=(0,e._)("h3",{id:"_7-vim-hdfs-site-xml",tabindex:"-1"},[(0,e._)("a",{class:"header-anchor",href:"#_7-vim-hdfs-site-xml","aria-hidden":"true"},"#"),(0,e.Uk)(" 7）vim hdfs-site.xml")],-1),A=(0,e.Uk)("dfs.replication"),O=(0,e.Uk)("3"),T=(0,e.Uk)("dfs.namenode.name.dir"),j=(0,e.Uk)("file:/data/hadoop/hdfs/name"),P=(0,e.Uk)("dfs.datanode.data.dir"),H=(0,e.Uk)("file:/data/hadoop/hdfs/data"),S=(0,e.Uk)("dfs.permissions.enabled"),M=(0,e.Uk)("false"),W=(0,e.Uk)("dfs.namenode.secondary.http-address"),E=(0,e.Uk)("主机名2:9868"),U=(0,e._)("pre",null,[(0,e._)("code",null,"    <property>\n      <name>dfs.http.address</name>\n      <value>0.0.0.0:50070</value>\n    </property>\n")],-1),D=(0,e.uE)('<h3 id="_8-vim-hadoop-env-sh" tabindex="-1"><a class="header-anchor" href="#_8-vim-hadoop-env-sh" aria-hidden="true">#</a> 8）vim hadoop-env.sh</h3><p>export JAVA_HOME=/opt/java/jdk1.8.0_341</p><p>export HADOOP_CONF_DIR=/opt/hadoop/hadoop-3.3.1/etc/hadoop</p><p>export HADOOP_OS_TYPE=${HADOOP_OS_TYPE:-$(uname -s)} export HADOOP_LOG_DIR=/data/hadoop/logs</p><p>export HADOOP_SSH_OPTS=&quot;-p 10086&quot; ##指定port.默认22号端口则不要加</p><p>注：hadoop,java 集群都需要装，可以在主机上修改完配置文件，scp到其他机器上，也可以一台一台修改</p><h2 id="_6、集群初始化-主节点" tabindex="-1"><a class="header-anchor" href="#_6、集群初始化-主节点" aria-hidden="true">#</a> 6、集群初始化（主节点）</h2><p>hadoop namenode -format</p><h2 id="_7、启停服务" tabindex="-1"><a class="header-anchor" href="#_7、启停服务" aria-hidden="true">#</a> 7、启停服务</h2><p>start-all.sh stop-all.sh 注：如果启动失败 先stop-all.sh，把/data/tmp/dfs 缓存文件 启动失败后需把缓存文件删除 已创建了uuid 把/data/hadoop/hdfs/ 删除 （新建yid失败，datanode节点未起来，因为该目录下保留了以前的id）</p><pre><code>         在进行初始化 hadoop namenode -format\n         ###强制退出安全策略\n          hdfs dfsadmin -safemode leave\n</code></pre><h2 id="_8、测试" tabindex="-1"><a class="header-anchor" href="#_8、测试" aria-hidden="true">#</a> 8、测试</h2><pre><code>         yarn-session.sh -jm 1024 -tm 2048 -s 10 -nm test -d -st、\n         可以通过访问http://localhost:8081查看Flink Web控制台\n</code></pre>',13),R={render:function(n,s){const a=(0,e.up)("name"),R=(0,e.up)("value"),J=(0,e.up)("property"),z=(0,e.up)("description"),C=(0,e.up)("configuration");return(0,e.wg)(),(0,e.iD)(e.HY,null,[t,(0,e.Wm)(J,null,{default:(0,e.w5)((()=>[(0,e.Wm)(a,null,{default:(0,e.w5)((()=>[p])),_:1}),(0,e.Wm)(R,null,{default:(0,e.w5)((()=>[r])),_:1})])),_:1}),(0,e.Wm)(J,null,{default:(0,e.w5)((()=>[(0,e.Wm)(a,null,{default:(0,e.w5)((()=>[l])),_:1}),(0,e.Wm)(R,null,{default:(0,e.w5)((()=>[o])),_:1}),(0,e.Wm)(z,null,{default:(0,e.w5)((()=>[c])),_:1})])),_:1}),m,(0,e.Wm)(C,null,{default:(0,e.w5)((()=>[(0,e.Wm)(J,null,{default:(0,e.w5)((()=>[(0,e.Wm)(a,null,{default:(0,e.w5)((()=>[i])),_:1}),(0,e.Wm)(R,null,{default:(0,e.w5)((()=>[b])),_:1})])),_:1}),u])),_:1}),d,h,k,(0,e.Wm)(J,null,{default:(0,e.w5)((()=>[(0,e.Wm)(a,null,{default:(0,e.w5)((()=>[f])),_:1}),(0,e.Wm)(R,null,{default:(0,e.w5)((()=>[v])),_:1})])),_:1}),(0,e.Wm)(J,null,{default:(0,e.w5)((()=>[(0,e.Wm)(a,null,{default:(0,e.w5)((()=>[y])),_:1}),(0,e.Wm)(R,null,{default:(0,e.w5)((()=>[g])),_:1})])),_:1}),_,x,w,(0,e.Wm)(C,null,{default:(0,e.w5)((()=>[(0,e.Wm)(J,null,{default:(0,e.w5)((()=>[(0,e.Wm)(a,null,{default:(0,e.w5)((()=>[A])),_:1}),(0,e.Wm)(R,null,{default:(0,e.w5)((()=>[O])),_:1})])),_:1}),(0,e.Wm)(J,null,{default:(0,e.w5)((()=>[(0,e.Wm)(a,null,{default:(0,e.w5)((()=>[T])),_:1}),(0,e.Wm)(R,null,{default:(0,e.w5)((()=>[j])),_:1})])),_:1}),(0,e.Wm)(J,null,{default:(0,e.w5)((()=>[(0,e.Wm)(a,null,{default:(0,e.w5)((()=>[P])),_:1}),(0,e.Wm)(R,null,{default:(0,e.w5)((()=>[H])),_:1})])),_:1}),(0,e.Wm)(J,null,{default:(0,e.w5)((()=>[(0,e.Wm)(a,null,{default:(0,e.w5)((()=>[S])),_:1}),(0,e.Wm)(R,null,{default:(0,e.w5)((()=>[M])),_:1})])),_:1}),(0,e.Wm)(J,null,{default:(0,e.w5)((()=>[(0,e.Wm)(a,null,{default:(0,e.w5)((()=>[W])),_:1}),(0,e.Wm)(R,null,{default:(0,e.w5)((()=>[E])),_:1})])),_:1}),U])),_:1}),D],64)}}}}]);